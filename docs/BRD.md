# Curator's Odysseia - 통합 비즈니스 요구사항 문서 (BRD)

**문서 버전**: 1.2  
**최종 업데이트**: 2025년 1월  
**프로젝트명**: Curator's Odysseia  
**부제**: Data Driven Art Archive  
**문서 유형**: Business Requirements Document (BRD)  
**상태**: 통합 문서 (웹 애플리케이션 + 게임 프로모션 기능)

---

## 목차

1. [Overview](#1-overview)
2. [Background & Motivation](#2-background--motivation)
3. [Target Audience](#3-target-audience)
4. [Goal & Direction](#4-goal--direction)
5. [Research & Analysis](#5-research--analysis)
6. [Process](#6-process)
7. [Final Design](#7-final-design)
8. [기술 아키텍처](#8-기술-아키텍처)
9. [게임 프로모션 기능 통합](#9-게임-프로모션-기능-통합)
10. [백엔드 로직 및 최적화 전략](#10-백엔드-로직-및-최적화-전략)
11. [사용자 가치 및 성공 지표](#11-사용자-가치-및-성공-지표)
12. [위험 요소 및 대응 방안](#12-위험-요소-및-대응-방안)
13. [게임-웹 통합 아키텍처](#13-게임-웹-통합-아키텍처)
14. [추가 위험요인 대응 및 최적화 전략](#14-추가-위험요인-대응-및-최적화-전략)
15. [부록](#15-부록)

---

## 1. Overview

### 프로젝트 제목
# **Curator's Odysseia**
## *Data Driven Art Archive*

### 한 줄 설명
> **Google Gemini 2.5 Flash와 Search Grounding을 활용한 실시간 아티스트 평가 및 궤적 분석 인터랙티브 웹 플랫폼**

### 핵심 컨셉

```
╔═══════════════════════════════════════════════════════════════════╗
║                                                                   ║
║                    CURATOR'S ODYSSEIA                             ║
║                  Data Driven Art Archive                           ║
║                                                                   ║
║  ┌─────────────────────────────────────────────────────────────┐ ║
║  │                                                             │ ║
║  │  "아티스트의 가치를 데이터로 읽다"                          │ ║
║  │                                                             │ ║
║  │  27가지 내러티브 조합 × 5가지 메트릭 × 실시간 AI 분석      │ ║
║  │                                                             │ ║
║  └─────────────────────────────────────────────────────────────┘ ║
║                                                                   ║
║  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          ║
║  │   OVERVIEW   │  │  CONNECTED   │  │  DEEP DIVE   │          ║
║  │              │  │              │  │              │          ║
║  │  ┌────────┐  │  │  ┌────────┐  │  │  ┌────────┐  │          ║
║  │  │ Radar  │  │  │  │  Grid │  │  │  │   AI   │  │          ║
║  │  │ Chart  │  │  │  │  View │  │  │  │ Report │  │          ║
║  │  └────────┘  │  │  └────────┘  │  │  └────────┘  │          ║
║  │  ┌────────┐  │  │  ┌────────┐  │  │  ┌────────┐  │          ║
║  │  │Trajectory│ │  │  │Compare │  │  │  │Timeline│  │          ║
║  │  │ Chart   │  │  │  │Analysis│  │  │  │Journey │  │          ║
║  │  └────────┘  │  │  └────────┘  │  │  └────────┘  │          ║
║  └──────────────┘  └──────────────┘  └──────────────┘          ║
║                                                                   ║
╚═══════════════════════════════════════════════════════════════════╝
```

### 핵심 기능 요약

| 기능 | 설명 | 핵심 가치 |
|------|------|-----------|
| **Valuation Matrix** | 5축 레이더 차트로 아티스트 메트릭 시각화 | 정량적 평가 |
| **Trajectory Analysis** | 시간별 가치 추이 라인 차트 | 궤적 패턴 분석 |
| **Comparative Intelligence** | 두 아티스트 비교 분석 (듀얼 차트, AI 리포트) | 객관적 비교 |
| **AI Curator Report** | Gemini 생성 종합 큐레이토리얼 리포트 | 전문 인사이트 |
| **Timeline Journey** | 생애 타임라인 시각화 (가로 스크롤, 파도 효과) | 스토리텔링 |
| **게임 프로모션 기능** | 27 Combinations 랭킹 시스템 기반 리듬 액션 게임 | 예술 교육 도구 |

### 현재 구현 상태

#### 프론트엔드 컴포넌트 (11개)
1. `App.tsx` - 메인 앱, 4개 뷰 관리 (LANDING, OVERVIEW, CONNECTED, DEEP_DIVE)
2. `ConnectedTab.tsx` - 무한 스크롤 작가 목록, 비교 분석 뷰
3. `DeepDiveTab.tsx` - 리포트 타이핑 애니메이션, 타임라인 진입
4. `DeepDiveChat.tsx` - Firestore 채팅 히스토리
5. `RadarChartComponent.tsx` - 레이더 차트 (단일/듀얼)
6. `LineChartComponent.tsx` - 라인 차트
7. `DualAreaChartComponent.tsx` - 듀얼 에어리어 차트
8. `TrajectoryTunnel.tsx` - 트라젝토리 터널
9. `TimelineJourney.tsx` - 타임라인 여정
10. `FlashlightGateway.tsx` - 플래시라이트 게이트웨이
11. `AIReport.tsx` - AI 리포트 컴포넌트

#### Firebase Functions (10개 엔드포인트)
1. `getDashboardData` - 작가 대시보드 데이터
2. `getArtistReport` - 작가 리포트
3. `getArtistTimeline` - 작가 타임라인
4. `getMetricInsight` - 메트릭 인사이트
5. `getMasterpieces` - 대표작 목록
6. `getComparativeAnalysis` - 비교 분석
7. `getDetailedTrajectory` - 상세 궤적 (타임아웃 300초, 메모리 512MiB)
8. `getArtistImage` - 작가 이미지 생성
9. `getArtistList` - 작가 목록 (타임아웃 120초, 메모리 512MiB)
10. `getChatResponse` - 채팅 응답

#### Firestore 컬렉션 (캐싱)
- `dashboard`, `report`, `timeline`, `insight`, `masterpieces`, `comparison`, `trajectory`, `images`, `artists`, `search`, `chats`

#### 게임 프로모션 기능
- 현재 구현되지 않음 (향후 통합 예정)
- 기획 문서: `docs/curatorbrd.md`
- 통합 계획: 웹 애플리케이션 내 프로모션 기능으로 통합

### 시연 영상 / 핵심 화면

```
┌─────────────────────────────────────────────────────────────────┐
│                    LANDING PAGE                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│                                                                 │
│         Curator's                                               │
│         Odysseia                                                │
│         Est. 2025 • Data Driven Art Archive                     │
│                                                                 │
│                                                                 │
│                                                                 │
│              Enter Artist Name or Keyword                      │
│              ───────────────────────────────────────            │
│              SEARCH ARCHIVE...                  [Explore →]    │
│              ───────────────────────────────────────            │
│                                                                 │
│              INDEXING 24,912 RECORDS                           │
│                                                                 │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 2. Background & Motivation

### 왜 이 주제를 선택했는가?

현대 미술 시장에서 **아티스트의 가치 평가**는 여전히 주관적이고 분산된 정보에 의존합니다. 큐레이터, 컬렉터, 연구자들은 아티스트를 평가하기 위해 경매 결과, 비평 리뷰, 전시 이력 등 다양한 소스를 수동으로 취합해야 하며, 이는 **시간 소모적이고 일관성이 부족**합니다.

### 문제 인식

#### 사회적 이슈

```
┌─────────────────────────────────────────────────────────────────┐
│                  현대 미술 시장의 구조적 문제                    │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  🔴 정보 비대칭성                                               │
│  ────────────────────────────────────────────────────────────    │
│  • 전문가만 접근 가능한 정보와 분석 도구                         │
│  • 일반 사용자는 아티스트 평가 기준을 이해하기 어려움           │
│  • 미술 시장의 투명성 부족                                     │
│                                                                 │
│  🟡 평가 기준의 주관성                                          │
│  ────────────────────────────────────────────────────────────    │
│  • 개인의 경험과 취향에 의존한 평가                             │
│  • 일관된 평가 체계 부재                                       │
│  • 정량적 데이터 부족                                          │
│                                                                 │
│  🟢 정보 과잉과 파편화                                          │
│  ────────────────────────────────────────────────────────────    │
│  • 경매, 전시, 비평 정보가 다양한 플랫폼에 분산                 │
│  • 정보 수집 및 통합에 시간 소모                               │
│  • 실시간 시장 동향 파악 어려움                                │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 사용자 인식 문제

| 사용자 그룹 | 현재 겪는 문제 | 영향 |
|-------------|----------------|------|
| **큐레이터** | 아티스트 비교 분석 시간 소모, 주관적 판단 | 전시 기획 효율성 저하 |
| **컬렉터** | 작품 수집 전략 수립 어려움, 시장 동향 파악 어려움 | 투자 판단 어려움 |
| **연구자** | 학술 연구를 위한 객관적 데이터 부족 | 연구 품질 저하 |
| **일반 사용자** | 아티스트 평가 기준 이해 어려움, 접근성 부족 | 미술 시장 참여 제한 |

### 디자인 동기 및 출발점

#### 1. 정량적 평가 체계의 필요성

```
기존: 주관적 평가 → 문제점
     ↓
해결: 5가지 메트릭 정량화 (0-100 스케일)
     ├─ Market Value (시장 가치)
     ├─ Critical Acclaim (비평적 인정)
     ├─ Historical (역사적 중요성)
     ├─ Social Impact (사회적 영향력)
     └─ Institutional (제도적 수용)
```

#### 2. 아티스트 궤적 패턴 분석

**27가지 내러티브 조합**을 통한 체계적 분류:

```
Phase 1: 초기 경력
├─ A. 스캔들/논란 (Scandal-driven)
├─ B. 조기 인정 (Early Recognition)
└─ C. 아웃사이더 (Outsider Path)

Phase 2: 중기 발전
├─ A. 제도권 편입 (Institutional Integration)
├─ B. 비평적 우위 (Critical Dominance)
└─ C. 시장 재정비 (Market Restructuring)

Phase 3: 후기 성과
├─ A. 국내 정상 (Domestic Peak)
├─ B. 국제적 거장 (International Master)
└─ C. 사후 재평가 (Posthumous Revaluation)

총 경우의 수 = 3 × 3 × 3 = 27 combinations
```

#### 3. AI 기반 실시간 정보 통합

- **Google Search Grounding**: 최신 경매 결과, 전시 정보, 비평 리뷰 실시간 수집
- **Gemini 2.5 Flash**: 큐레이토리얼 리포트 및 비교 분석 자동 생성
- **정보 출처 투명성**: 모든 분석 결과에 Grounding Source 명시

#### 4. 게임을 통한 예술 교육

- **27 Combinations 랭킹 시스템**: 게임 내 Tier/Axis 시스템과 웹 애플리케이션의 메트릭 시스템 연동
- **체험적 학습**: 리듬 액션 게임을 통해 큐레이터의 역할과 작품 선별 과정을 몰입형으로 경험
- **접근성**: 웹 브라우저만으로 접근 가능한 범용적 경험

---

## 3. Target Audience

### 주요 사용자 정의

#### 페르소나 1: 학습형 큐레이터 (Learning Curator)

```
┌─────────────────────────────────────────────────────────────────┐
│  페르소나: 김예술 (25세, 예술 대학원생)                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  목표: 큐레이터가 되는 방법을 실전적으로 배우고 싶음            │
│                                                                 │
│  동기:                                                          │
│  • 데이터를 통해 아티스트 평가 기준과 궤적을 이해               │
│  • 전시 기획 시 객관적 근거 확보                               │
│  • 다양한 아티스트 패턴 학습                                   │
│  • 게임을 통한 큐레이터 역할 체험                              │
│                                                                 │
│  행동 패턴:                                                     │
│  • Deep Dive 리포트와 Timeline 탐색 선호                       │
│  • Chat Interface로 질문하며 학습                              │
│  • 메트릭 비교에 집중                                          │
│  • 게임 프로모션 기능을 통한 체험적 학습                        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 페르소나 2: 전략적 컬렉터 (Strategic Collector)

```
┌─────────────────────────────────────────────────────────────────┐
│  페르소나: 이컬렉 (45세, 아트 컬렉터)                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  목표: 작품 수집 전략 수립 및 투자 판단                         │
│                                                                 │
│  동기:                                                          │
│  • 시장 가치와 트라젝토리 분석을 통한 의사결정                 │
│  • 아티스트 비교를 통한 수집 전략 수립                          │
│  • 실시간 시장 동향 파악                                        │
│                                                                 │
│  행동 패턴:                                                     │
│  • Market Value 메트릭에 집중                                   │
│  • Trajectory 분석으로 가치 추이 확인                           │
│  • Connected 페이지에서 비교 분석 활용                          │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 페르소나 3: 문화 탐험가 (Cultural Explorer)

```
┌─────────────────────────────────────────────────────────────────┐
│  페르소나: 박문화 (32세, 일반 사용자)                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  목표: 현대 미술 아티스트 탐색 및 학습                          │
│                                                                 │
│  동기:                                                          │
│  • 예술에 대한 접근성 높은 경험 추구                           │
│  • 새로운 아티스트 발견                                         │
│  • 시각적 데이터를 통한 직관적 이해                             │
│  • 게임을 통한 재미있는 예술 학습                              │
│                                                                 │
│  행동 패턴:                                                     │
│  • Overview 페이지에서 시각적 탐색                              │
│  • Masterpiece 갤러리 감상                                      │
│  • 간단한 비교 분석으로 학습                                    │
│  • 게임 프로모션 기능으로 예술 개념 학습                        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 페르소나 4: 미술 연구자 (Art Researcher)

```
┌─────────────────────────────────────────────────────────────────┐
│  페르소나: 최연구 (38세, 대학 교수)                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  목표: 아티스트 비교 분석 및 학술 연구                          │
│                                                                 │
│  동기:                                                          │
│  • 객관적 데이터를 통한 학술 연구 지원                          │
│  • 아티스트 궤적 패턴 분석                                      │
│  • Grounding Source를 통한 출처 확인                           │
│                                                                 │
│  행동 패턴:                                                     │
│  • 메트릭 비교 분석에 집중                                      │
│  • Grounding Source 확인으로 신뢰성 검증                       │
│  • 학술적 인사이트 추출                                         │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 사용자의 정보 요구 및 행동 패턴 요약

```
┌─────────────────────────────────────────────────────────────────┐
│                    사용자 여정 맵 (User Journey)                │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [인지] → [탐색] → [분석] → [의사결정] → [공유]                │
│    │         │         │          │          │                 │
│    ▼         ▼         ▼          ▼          ▼                 │
│  랜딩    Overview   Connected  Deep Dive   리포트              │
│  페이지   탐색      비교 분석   심층 연구   저장/공유          │
│                                                                 │
│  주요 터치포인트:                                               │
│  • 검색 입력: 아티스트명 또는 키워드                            │
│  • 레이더 차트 클릭: 메트릭별 상세 인사이트                     │
│  • 비교 분석: 두 아티스트 선택 및 비교                          │
│  • AI 리포트: 자동 생성 큐레이토리얼 리포트                     │
│  • 타임라인: 생애 궤적 시각화                                   │
│  • 게임 프로모션: 27 Combinations 랭킹 시스템 체험            │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 4. Goal & Direction

### 연구 목표

#### 1. 데이터 기반 큐레이토리얼 인텔리전스 구축

```
목표: 분산된 아티스트 정보를 통합하여 일관된 평가 체계 제공

방법:
├─ 5가지 메트릭 정량화 (0-100 스케일)
├─ 27가지 내러티브 조합 기반 랭킹 시스템
├─ Google Search Grounding을 통한 실시간 정보 수집
├─ AI 기반 분석 및 리포트 자동 생성
└─ 게임을 통한 예술 교육 도구 제공

결과:
└─ 객관적이고 일관된 아티스트 평가 체계
```

#### 2. 인터랙티브 시각화를 통한 인사이트 전달

```
목표: 복잡한 데이터를 직관적인 차트로 시각화

방법:
├─ 레이더 차트: 5축 메트릭 시각화
├─ 라인 차트: 시간별 가치 추이
├─ 듀얼 차트: 두 아티스트 비교
├─ 타임라인: 생애 궤적 스토리텔링
└─ 게임 인터랙션: Tier/Axis 시스템 시각화

결과:
└─ 사용자 인터랙션을 통한 탐색적 분석 지원
```

### 디자인 목표

| 목표 | 설명 | 구현 방법 |
|------|------|-----------|
| **미니멀리즘** | 깔끔하고 전문적인 UI로 데이터에 집중 | Generous whitespace, 단순한 레이아웃 |
| **타이포그래피 중심** | Serif 폰트를 활용한 편집 디자인 | Playfair Display (Serif) + Inter (Sans) |
| **인터랙티브 스토리텔링** | 스크롤 기반 내러티브와 인터랙티브 차트 | 가로 스크롤 타임라인, 클릭 인터랙션 |
| **데이터 신뢰성** | Grounding Source를 통한 정보 출처 투명성 | 모든 분석 결과에 출처 링크 표시 |
| **게임 교육** | 게임을 통한 예술 교육 도구 | 27 Combinations 랭킹 시스템 기반 게임 |

### 디자인을 통해 달성하고자 한 가치

#### 즉각적 가치 (Immediate Value)

```
┌─────────────────────────────────────────────────────────────────┐
│  • 통합된 정보: 분산된 아티스트 정보를 한 곳에서 확인          │
│  • 실시간 업데이트: 최신 경매 결과, 전시 정보 반영             │
│  • 신뢰할 수 있는 소스: Grounding Source 투명성                │
│  • 직관적 비교: 레이더 차트와 트라젝토리 차트로 즉각적 패턴 인식│
│  • 재미있는 학습: 게임을 통한 예술 개념 이해                  │
└─────────────────────────────────────────────────────────────────┘
```

#### 중기 가치 (Medium-term Value)

```
┌─────────────────────────────────────────────────────────────────┐
│  • 수집 전략: 컬렉터의 작품 수집 전략 수립 지원                │
│  • 전시 기획: 큐레이터의 아티스트 선택 및 전시 구성            │
│  • 연구 효율성: 아티스트 비교 분석 시간 단축                   │
│  • 새로운 발견: Connected 페이지를 통한 유사 아티스트 탐색    │
│  • 체험적 학습: 게임을 통한 큐레이터 역할 이해                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 장기 가치 (Long-term Value)

```
┌─────────────────────────────────────────────────────────────────┐
│  • 전문성 향상: AI 리포트를 통한 큐레이토리얼 인사이트 습득    │
│  • 시장 이해: 트라젝토리 분석을 통한 미술 시장 동향 이해       │
│  • 접근성 향상: 일반 사용자도 전문적 분석 도구 활용            │
│  • 네트워크 효과: 공통 관심사를 가진 사용자 간 연결           │
│  • 예술 교육: 게임을 통한 예술 교육 도구로서의 가치            │
└─────────────────────────────────────────────────────────────────┘
```

### 기대 효과 및 사회적 기여

#### 1. 미술 시장의 투명성 향상

- 정량적 평가 체계로 주관성 감소
- 정보 접근성 향상으로 시장 참여 확대
- 데이터 기반 의사결정 지원

#### 2. 큐레이토리얼 인텔리전스 민주화

- 전문가만 사용하던 분석 도구를 일반 사용자에게 제공
- AI 기반 인사이트로 전문성 격차 완화
- 교육적 가치 제공 (웹 + 게임)

#### 3. 미술 시장 데이터 축적

- 사용자 행동 데이터를 통한 시장 인사이트 도출
- 아티스트 궤적 패턴 데이터베이스 구축
- 미술사 연구 자료 제공

---

## 5. Research & Analysis

### 데이터 수집 출처, 방법, 범위

#### 데이터 소스 매트릭스

| 데이터 유형 | 출처 | 수집 방법 | 범위 |
|------------|------|-----------|------|
| **경매 데이터** | 소더비, 크리스티, 필립스 | Google Custom Search API | 2020-2024 경매 결과 |
| **비평 데이터** | 아트포럼, Artnet, Hyperallergic | Gemini Search Grounding | 주요 학술지, 비평 리뷰 |
| **제도 데이터** | 미술관 웹사이트, 비엔날레 공식 사이트 | Google Custom Search API | 소장품, 전시 이력 |
| **소셜 데이터** | 인스타그램, 트위터 API | Social Media Analytics | 해시태그, 언급량 |
| **학술 데이터** | JSTOR, Art History Database | Academic Search | 논문, 학술지 등재 |
| **이미지 데이터** | Wikipedia API, Google Custom Search Image API | 이미지 검색 API | 작가 프로필, 작품 이미지 |

#### 데이터 수집 프로세스

```
┌─────────────────────────────────────────────────────────────────┐
│                    데이터 수집 워크플로우                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  1. 사용자 입력 (아티스트명)                                    │
│     │                                                           │
│     ▼                                                           │
│  2. Firestore 캐시 확인 (24시간 TTL)                           │
│     │                                                           │
│     ▼ (캐시 미스)                                               │
│  3. Google Custom Search API 호출 (우선)                       │
│     │                                                           │
│     ▼                                                           │
│  4. Gemini 2.5 Flash API 호출                                   │
│     ├─ 경매 데이터 검색                                         │
│     ├─ 비평 리뷰 검색                                           │
│     ├─ 전시 이력 검색                                           │
│     └─ 소셜 미디어 데이터 검색                                  │
│     │                                                           │
│     ▼                                                           │
│  5. 데이터 정규화 및 메트릭 계산                                │
│     ├─ Market Value: 경매가 기반 (0-100)                       │
│     ├─ Critical Acclaim: 비평 리뷰 빈도 및 긍정도              │
│     ├─ Historical: 학술 논문 인용 및 등재                      │
│     ├─ Social Impact: 소셜 미디어 언급량                        │
│     └─ Institutional: 미술관 소장품 수, 비엔날레 참여          │
│     │                                                           │
│     ▼                                                           │
│  6. Grounding Source 추출 및 저장                               │
│     │                                                           │
│     ▼                                                           │
│  7. Firestore 캐시 저장 (24시간 TTL)                           │
│     │                                                           │
│     ▼                                                           │
│  8. 사용자에게 결과 표시                                        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 분석 결과 시각화

#### 5가지 메트릭 구조 다이어그램

```
                    Market Value (시장 가치)
                         ▲
                        /|\
                       / | \
                      /  |  \
                     /   |   \
    Institutional ◄─────●─────► Critical Acclaim
    (제도적 수용)        │      (비평적 인정)
                     \   |   /
                      \  |  /
                       \ | /
                        \|/
                         ▼
        Social Impact ◄─────► Historical
        (사회적 영향력)      (역사적 중요성)
```

#### 메트릭별 계산 공식

| 메트릭 | 계산 공식 | 데이터 소스 |
|--------|-----------|-------------|
| **Market Value** | `(경매가 평균 / 최고 경매가) × 100` | 소더비, 크리스티 경매 결과 |
| **Critical Acclaim** | `(긍정 리뷰 비율 × 학술지 등재 수) × 가중치` | 아트포럼, 학술지 |
| **Historical** | `(논문 인용 수 + 교과서 등재 여부) × 가중치` | JSTOR, Art History DB |
| **Social Impact** | `log(소셜 미디어 언급량) × 10` | 인스타그램, 트위터 |
| **Institutional** | `(소장품 수 × 2 + 비엔날레 참여 × 5) × 가중치` | 미술관 웹사이트 |

#### 27가지 내러티브 조합 인포그래픽

```
┌─────────────────────────────────────────────────────────────────┐
│              27 COMBINATIONS MATRIX                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Phase 1 (초기 경력)    Phase 2 (중기 발전)    Phase 3 (후기 성과)│
│  ──────────────────    ──────────────────    ──────────────────│
│                                                                 │
│  A. 스캔들/논란         A. 제도권 편입         A. 국내 정상      │
│  B. 조기 인정          B. 비평적 우위         B. 국제적 거장     │
│  C. 아웃사이더         C. 시장 재정비         C. 사후 재평가     │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐ │
│  │                                                           │ │
│  │  총 경우의 수 = 3 × 3 × 3 = 27 combinations              │ │
│  │                                                           │ │
│  │  예시:                                                    │ │
│  │  • A-A-B: 스캔들 → 제도권 편입 → 국제적 거장             │ │
│  │  • B-B-A: 조기 인정 → 비평적 우위 → 국내 정상           │ │
│  │  • C-C-C: 아웃사이더 → 시장 재정비 → 사후 재평가        │ │
│  │                                                           │ │
│  └───────────────────────────────────────────────────────────┘ │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 인사이트 요약

#### 주요 발견 패턴

**1. 궤적 패턴 분석**

```
가장 높은 최종 랭크 달성 패턴:
초기 논란 → 중기 제도권 편입 → 후기 국제적 거장

예시 아티스트:
• Damien Hirst: 스캔들 → 제도권 편입 → 국제적 거장 (랭크 #2)
• Jean-Michel Basquiat: 아웃사이더 → 비평적 우위 → 국제적 거장 (랭크 #3)
```

**2. 메트릭 상관관계**

```
강한 양의 상관관계:
• Institutional ↔ Historical (r = 0.78)
  → 제도적 수용이 높을수록 역사적 중요성도 높음

약한 상관관계:
• Market Value ↔ Critical Acclaim (r = 0.32)
  → 시장 가치와 비평적 인정은 독립적
```

**3. 시장 동향 패턴**

```
2020-2024 트렌드:
• Social Impact 메트릭 평균 상승: 72 → 85 (+18%)
  → 소셜 미디어의 영향력 증가

• Institutional 메트릭 안정: 88 → 89 (+1%)
  → 제도적 수용은 안정적
```

---

## 6. Process

### 전체 디자인 프로세스 맵

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         DESIGN PROCESS MAP                              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌──────────┐   ┌──────────┐   ┌──────────┐   ┌──────────┐            │
│  │ RESEARCH │ → │ IDEATION │ → │ PROTOTYPE│ → │  TEST    │            │
│  └────┬─────┘   └────┬─────┘   └────┬─────┘   └────┬─────┘            │
│       │              │              │              │                   │
│       ▼              ▼              ▼              ▼                   │
│  ┌──────────┐   ┌──────────┐   ┌──────────┐   ┌──────────┐            │
│  │ 시장조사 │   │ IA 설계  │   │ 와이어   │   │ 사용성   │            │
│  │ 사용자   │   │ 유저플로우│   │ 프레임   │   │ 테스트   │            │
│  │ 인터뷰   │   │ 컨셉개발 │   │ 개발     │   │ 검증     │            │
│  └──────────┘   └──────────┘   └────┬─────┘   └────┬─────┘            │
│                                     │              │                   │
│                                     ▼              ▼                   │
│                                ┌──────────┐   ┌──────────┐            │
│                                │ ITERATE  │ ← │ FEEDBACK │            │
│                                └──────────┘   └──────────┘            │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 주요 산출물

#### 1. Information Architecture (IA)

```
Curator's Odysseia
│
├── [Entry Layer]
│   └── Landing Page (/)
│       ├── Brand Identity
│       ├── Search Input
│       └── Archive Stats
│
├── [Analysis Layer]
│   ├── Overview (/overview)
│   │   ├── Hero Section (아티스트 이미지, 랭크)
│   │   ├── Valuation Matrix (레이더 차트)
│   │   └── Trajectory Index (라인 차트)
│   │
│   ├── Connected (/connected)
│   │   ├── Grid View (5-Column 아티스트 그리드, 무한 스크롤)
│   │   └── Expanded View
│   │       ├── Hero Section
│   │       ├── Dual Radar Chart
│   │       ├── Trajectory Tunnel (가로 스크롤)
│   │       ├── Comparative Analysis (AI 리포트)
│   │       └── Masterpieces Gallery
│   │
│   └── Deep Dive (/deep-dive)
│       ├── AI Report (타이핑 애니메이션)
│       ├── Chat Interface (하단 고정 패널, Firestore 히스토리)
│       ├── Flashlight Gateway (마스크 효과)
│       └── Timeline Journey (가로 스크롤 타임라인)
│
├── [Modal Layer]
│   ├── Masterpiece Carousel (전체 화면)
│   ├── Metric Insight Modal (중앙 정렬)
│   └── Rank Explanation Modal (방법론 설명)
│
└── [Game Promotion Layer] (향후 통합)
    └── Curator Game
        ├── 게임 진입점 (웹 애플리케이션 내)
        ├── 27 Combinations 랭킹 시스템
        └── Tier/Axis 시스템 시각화
```

#### 2. User Flow Diagram

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        PRIMARY USER FLOW                                 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────┐                                                        │
│  │   LANDING   │                                                        │
│  │    PAGE     │                                                        │
│  └──────┬──────┘                                                        │
│         │ 검색 입력                                                     │
│         ▼                                                               │
│  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐              │
│  │  OVERVIEW   │ ──→ │  CONNECTED   │ ──→ │  DEEP DIVE  │              │
│  │   (탭1)     │     │    (탭2)     │     │    (탭3)    │              │
│  └──────┬──────┘     └──────┬──────┘     └──────┬──────┘              │
│         │                    │                    │                     │
│         ▼                    ▼                    ▼                     │
│  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐              │
│  │ 레이더 차트 │     │   그리드    │     │  AI Report  │              │
│  │   클릭      │     │   뷰        │     │             │              │
│  └──────┬──────┘     └──────┬──────┘     └──────┬──────┘              │
│         │                    │                    │                     │
│         ▼                    ▼                    ▼                     │
│  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐              │
│  │Masterpiece │     │  Expanded  │     │  Timeline   │              │
│  │  Modal     │     │    View     │     │  Journey    │              │
│  └─────────────┘     └─────────────┘     └─────────────┘              │
│                                                                         │
│  [게임 프로모션 진입점]                                                │
│         │                                                               │
│         ▼                                                               │
│  ┌─────────────┐                                                        │
│  │ CURATOR     │                                                        │
│  │   GAME      │                                                        │
│  │ (27 Comb.)  │                                                        │
│  └─────────────┘                                                        │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 3. 와이어프레임 스케치

**Overview Page 와이어프레임:**

```
┌─────────────────────────────────────────────────────────────────┐
│  [Brand]  │  [Nav]  │  [Artist Selector]                        │
├───────────┴─────────┴───────────────────────────────────────────┤
│                                                                 │
│  ┌──────────────────────┐  ┌──────────────────────────────┐   │
│  │                      │  │                              │   │
│  │   [Artist Image]     │  │  Henri Matisse               │   │
│  │   (Wikipedia/Google) │  │  ──────────────────────────  │   │
│  │                      │  │                              │   │
│  │                      │  │  Nationality: French        │   │
│  │                      │  │                              │   │
│  │                      │  │  Curatorial Note:           │   │
│  │                      │  │  파격적 궤적의 순수...      │   │
│  │                      │  │                              │   │
│  │  ───────────────────│  ├──────────────────────────────┤   │
│  │  Global Rank  #1  ℹ  │  │  ┌─────────────┐            │   │
│  │  Born 1869          │  │  │ VALUATION   │            │   │
│  └──────────────────────┘  │  │  MATRIX     │            │   │
│                             │  │  [Radar]    │            │   │
│                             │  └─────────────┘            │   │
│                             │  ┌─────────────┐            │   │
│                             │  │ TRAJECTORY │            │   │
│                             │  │  INDEX     │            │   │
│                             │  │  [Line]    │            │   │
│                             │  └─────────────┘            │   │
│                             └──────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

**Connected Page Expanded View 와이어프레임:**

```
┌─────────────────────────────────────────────────────────────────┐
│                                                      [✕ Close]   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│                    [Target Artist Hero]                         │
│                    Jean-Michel Basquiat                         │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│  01 — COMPARATIVE METRICS                                       │
│                                                                 │
│  ┌─────────────────────────────────────────┐                 │
│  │         [Dual Radar Chart]                │                 │
│  │         Market Value                       │                 │
│  │              ▲                             │                 │
│  │  Inst. ●─────● Critical                   │                 │
│  │              ▼                             │                 │
│  │    Social ◄───► Historical                 │                 │
│  └─────────────────────────────────────────┘                 │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│  02 — TRAJECTORY COMPARISON                                    │
│                                                                 │
│  [Total] [Institution] [Discourse] [Academy] [Network]         │
│                                                                 │
│     100 ┬─────────────────────────────────────                  │
│         │    ╱╲    ╱╲                                          │
│      50 ┼───╱──╲──╱──╲──────────────────────                  │
│         │  ╱    ╲╱                                             │
│       0 ┴─┴──────┴──────┴──────┴──────► Age                  │
│           20    30    40    50    60                           │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│  03 — COMPARATIVE INTELLIGENCE                                 │
│                                                                 │
│  [AI Generated Report Text...]                                  │
│                                                                 │
│  [Verified Sources: artforum.com, sothebys.com]                 │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 인터랙션 설명 다이어그램

#### Radar Chart Interaction

```
┌─────────────────────────────────────────────────────────────────┐
│                  RADAR CHART INTERACTION                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐ │
│  │                                                           │ │
│  │                    Market Value                           │ │
│  │                         ▲                                 │ │
│  │                        /|\                                │ │
│  │                       / │ \                               │ │
│  │                      /  │  \                              │ │
│  │                     /   │   \                             │ │
│  │  Institutional ◄───●────●────●───► Critical Acclaim      │ │
│  │                     \   │   /                             │ │
│  │                      \  │  /                              │ │
│  │                       \ │ /                               │ │
│  │                        \|/                                │ │
│  │                         ▼                                 │ │
│  │            Social Impact ◄───► Historical                 │ │
│  │                                                           │ │
│  └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│  인터랙션:                                                      │
│  • 축 클릭 ────→ Masterpiece Carousel Modal                    │
│  • 포인트 클릭 → Metric Insight Modal (AI 생성)                 │
│  • 호버 ──────→ 값 강조 + 툴팁 표시                            │
│  • 듀얼 모드: Most Similar Axis 자동 강조                      │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### Trajectory Tunnel Interaction

```
┌─────────────────────────────────────────────────────────────────┐
│              TRAJECTORY TUNNEL INTERACTION                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐ │
│  │                                                           │ │
│  │  [Total] [Institution] [Discourse] [Academy] [Network]   │ │
│  │                                                           │ │
│  │     100 ┬─────────────────────────────────────────────    │ │
│  │         │    ╱╲    ╱╲                                    │ │
│  │      50 ┼───╱──╲──╱──╲──────────────────────────────    │ │
│  │         │  ╱    ╲╱                                       │ │
│  │       0 ┴─┴──────┴──────┴──────┴──────┴──────► Age      │ │
│  │           20    30    40    50    60    70                │ │
│  │                                                           │ │
│  │  [파티클 효과] [스포트라이트 효과] [가로 스크롤]         │ │
│  │                                                           │ │
│  └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│  인터랙션:                                                      │
│  • 가로 스크롤 ─→ 파노라마 뷰 이동                             │
│  • 메트릭 버튼 ─→ Total/Institution/Discourse/Academy/Network 전환│
│  • 포인트 클릭 ─→ 해당 시점 비교 인사이트 생성                 │
│  • 마우스 이동 ─→ 파티클 가속 + 스포트라이트 효과              │
│  • Gap Range: Total 메트릭에서 두 값 사이 차이 시각화         │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### Timeline Journey Interaction

```
┌─────────────────────────────────────────────────────────────────┐
│                 TIMELINE JOURNEY INTERACTION                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐ │
│  │                                                           │ │
│  │  Era 1: 20-30세          Era 2: 30-40세                 │ │
│  │  ┌─────┐                 ┌─────┐                         │ │
│  │  │Card │                 │Card │                         │ │
│  │  │Event│                 │Event│                         │ │
│  │  └─────┘                 └─────┘                         │ │
│  │                                                           │ │
│  │  [가로 스크롤] → [각 Era = 100vw]                         │ │
│  │                                                           │ │
│  │  카드 호버 ──→ 확장 + 이미지 지연 로딩                    │ │
│  │  카드 클릭 ──→ Event Modal (상세 정보)                    │ │
│  │  배경 마우스 → RippleBackground 파도 효과                 │ │
│  │  Data Sonification: Tone.js 기반 오디오 재생             │ │
│  │                                                           │ │
│  └───────────────────────────────────────────────────────────┘ │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 7. Final Design

### Information Visualization

#### 7.1 Web Interface Design

##### Landing Page

```
┌─────────────────────────────────────────────────────────────────┐
│                                                                 │
│                                                                 │
│         Curator's                                               │
│         Odysseia                                                │
│         Est. 2025 • Data Driven Art Archive                     │
│                                                                 │
│                                                                 │
│                                                                 │
│              Enter Artist Name or Keyword                      │
│              ───────────────────────────────────────            │
│              SEARCH ARCHIVE...                  [Explore →]    │
│              ───────────────────────────────────────            │
│                                                                 │
│              INDEXING 24,912 RECORDS                           │
│                                                                 │
│                                                                 │
│                                                                 │
│  [Subtle Background Noise Pattern]                              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**디자인 특징:**
- 미니멀한 레이아웃: 브랜드 타이포그래피 중심
- 검색 입력 필드: 큰 폰트 사이즈 (text-4xl md:text-6xl)
- 애니메이션: Fade-in, Slide-up 효과

##### Overview Page

```
┌─────────────────────────────────────────────────────────────────┐
│  Curator's    │  OVERVIEW   CONNECTED   DEEP DIVE  │  ▼ Matisse│
│  Odysseia     │     ▬▬▬                            │           │
├───────────────┴────────────────────────────────────┴───────────┤
│                                                                 │
│  ┌──────────────────────┐  ┌──────────────────────────────┐    │
│  │                      │  │                              │    │
│  │   [Artist Image]      │  │  Henri Matisse               │    │
│  │   (Wikipedia/Google) │  │  ────────────────────────── │    │
│  │   Grayscale          │  │                              │    │
│  │   → Color on hover   │  │  Nationality: French         │    │
│  │                      │  │                              │    │
│  │                      │  │  Curatorial Note:            │    │
│  │                      │  │  파격적 궤적의 순수         │    │
│  │                      │  │  아웃사이더: 구설수와...    │    │
│  │  ───────────────────│  ├──────────────────────────────┤    │
│  │  Global Rank  #1  ℹ  │  │  ┌─────────────┐            │    │
│  │  Born 1869          │  │  │ VALUATION   │            │    │
│  └──────────────────────┘  │  │  MATRIX     │            │    │
│                             │  │  ┌───┐      │            │    │
│                             │  │  │◇◇◇│      │            │    │
│                             │  │  │◇◇◇│      │            │    │
│                             │  │  └───┘      │            │    │
│                             │  └─────────────┘            │    │
│                             │  ┌─────────────┐            │    │
│                             │  │ TRAJECTORY │            │    │
│                             │  │  INDEX     │            │    │
│                             │  │  ┌─────┐   │            │    │
│                             │  │  │/~~~│   │            │    │
│                             │  │  │~~~~│   │            │    │
│                             │  │  └─────┘   │            │    │
│                             │  └─────────────┘            │    │
├─────────────────────────────────────────────────────────────────┤
│  System Status: Online          Data Updated: 2025-01-15        │
└─────────────────────────────────────────────────────────────────┘
```

**디자인 특징:**
- 2-Column 레이아웃: 이미지 (5) + 정보 (7)
- 레이더 차트: 인터랙티브 (축/포인트 클릭)
- 트라젝토리 차트: 시간별 가치 추이
- 실제 작가 이미지: Wikipedia API 또는 Google Custom Search Image API

##### Connected Page (Expanded View)

```
┌─────────────────────────────────────────────────────────────────┐
│                                                      [✕ Close] │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│                    [Target Artist Hero Section]                 │
│                    Jean-Michel Basquiat                         │
│                    "제도 이탈 후 국제적 인정..."               │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│  01 — COMPARATIVE METRICS                                      │
│                                                                 │
│  Structural Divergence                                          │
│                                                                 │
│     ┌─────────────────────────────────────────┐                │
│     │         Market Value                     │                │
│     │              ▲                           │                │
│     │             /|\                          │                │
│     │  Inst. ●─────●─────● Critical           │                │
│     │             \|/                          │                │
│     │              ▼                           │                │
│     │    Social ◄─────► Historical             │                │
│     └─────────────────────────────────────────┘                │
│                                                                 │
│     ── Henri Matisse (Reference)                               │
│     ── Jean-Michel Basquiat (Target)                           │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│  02 — TRAJECTORY COMPARISON                                    │
│                                                                 │
│  [Total] [Institution] [Discourse] [Academy] [Network]        │
│                                                                 │
│     100 ┬────────────────────────────────────────────────       │
│         │    ╱╲    ╱╲                                          │
│      50 ┼───╱──╲──╱──╲──────────────────────────────          │
│         │  ╱    ╲╱                                             │
│       0 ┴─┴──────┴──────┴──────┴──────┴──────► Age            │
│           20    30    40    50    60    70                      │
│                                                                 │
│  [파티클 효과] [스포트라이트] [가로 스크롤]                    │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│  03 — COMPARATIVE INTELLIGENCE                                 │
│                                                                 │
│  "두 아티스트는 초기 경력에서 비제도권적 출발이라는            │
│   공통점을 공유하지만, Matisse는 순수 미술의 정통 경로를       │
│   따른 반면, Basquiat는 그래피티 아트에서 시작하여..."        │
│                                                                 │
│  [Verified Sources: artforum.com, sothebys.com, tate.org.uk]   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**디자인 특징:**
- Sticky Stacking: 각 섹션이 화면에 고정되며 스크롤 시 전환
- 듀얼 레이더 차트: 두 아티스트 비교 시각화
- 트라젝토리 터널: 가로 스크롤 파노라마 뷰
- 무한 스크롤: Connected Tab 그리드 뷰에서 작가 목록 동적 로딩

##### Deep Dive Page

```
┌─────────────────────────────────────────────────────────────────┐
│  Curator's    │  OVERVIEW   CONNECTED   DEEP DIVE  │  ▼ Matisse│
│  Odysseia     │                    ▬▬▬             │           │
├───────────────┴────────────────────────────────────┴───────────┤
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐ │
│  │                                                           │ │
│  │  AI CURATOR REPORT                                       │ │
│  │  ──────────────────────────────────────────────────────── │ │
│  │                                                           │ │
│  │  [타이핑 애니메이션 효과]                                │ │
│  │                                                           │ │
│  │  "Henri Matisse는 20세기 초 프랑스 미술계에서...        │ │
│  │   그의 작품은 색채와 형태의 순수성을 추구하며..."        │ │
│  │                                                           │ │
│  └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐ │
│  │                                                           │ │
│  │  [Chat Interface - 하단 고정 패널]                        │ │
│  │  [Firestore 히스토리 저장]                               │ │
│  │                                                           │ │
│  │  [INSTITUTION] [DISCOURSE] [ACADEMY] [NETWORK] [MARKET] │ │
│  │                                                           │ │
│  │  ┌─────────────────────────────────────────────────────┐ │ │
│  │  │ AI: Matisse의 제도적 수용은...                    │ │ │
│  │  └─────────────────────────────────────────────────────┘ │ │
│  │                                                           │ │
│  │  [Type your question...]                    [Send]        │ │
│  │                                                           │ │
│  └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│  ┌───────────────────────────────────────────────────────────┐ │
│  │                                                           │ │
│  │  [Flashlight Gateway - 우측 사이드바]                     │ │
│  │                                                           │ │
│  │  ≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋≋ │ │
│  │                                                           │ │
│  │  [마스크 기반 플래시라이트 효과]                          │ │
│  │  [마우스 추적: 120px 반경]                                │ │
│  │                                                           │ │
│  │  [Click to Enter Timeline Journey]                        │ │
│  │                                                           │ │
│  └───────────────────────────────────────────────────────────┘ │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**디자인 특징:**
- AI 리포트: 타이핑 애니메이션 (가변 속도)
- Chat Interface: Glassmorphism 디자인, 하단 고정, Firestore 히스토리
- Flashlight Gateway: 마스크 기반 플래시라이트 효과

#### 7.2 Design System

##### Color System

```
PRIMARY COLORS
───────────────────────────────────────────────────────────────
██████  #28317C   Deep Royal Blue   Primary / Brand / Reference
██████  #3B82F6   Azure Blue        Secondary / Target Artist
██████  #FFFFFF   White             Background / Secondary

METRIC COLORS
───────────────────────────────────────────────────────────────
██████  #FFFFFF   White       Total (총평균)
██████  #38BDF8   Light Blue  Institution (제도적 수용)
██████  #818CF8   Indigo      Discourse (담론적 영향력)
██████  #C084FC   Purple      Academy (학술적 인정)
██████  #2DD4BF   Teal        Network (네트워크 영향력)

GRAYSCALE
───────────────────────────────────────────────────────────────
██████  #F9F9F9   Gray 50     Subtle backgrounds
██████  #E5E5E5   Gray 200    Borders / Grid lines
██████  #A3A3A3   Gray 400    Secondary text / Labels
██████  #737373   Gray 500    Body text
```

##### Typography System

```
FONT FAMILIES
───────────────────────────────────────────────────────────────
Playfair Display (Serif)
  용도: 히어로 제목, 브랜드, 아티스트 이름
  웨이트: 400 (Regular), 600 (SemiBold), Italic

Inter (Sans-serif)
  용도: 본문, UI 요소, 라벨
  웨이트: 200, 300, 400, 500, 600

TYPE SCALE
───────────────────────────────────────────────────────────────
HERO
  9xl (128px)  : ConnectedTab 히어로
  7xl (72px)   : 랜딩 페이지 브랜드, Overview 아티스트명
  6xl (60px)   : 랜딩 페이지 검색 입력

HEADINGS
  5xl (48px)   : 주요 섹션 제목
  4xl (36px)   : 서브 섹션 제목, 모달 제목
  3xl (30px)   : 카드 제목

BODY
  xl (20px)    : 리드 텍스트
  lg (18px)    : 큰 본문
  base (16px)  : 기본 본문

MICRO
  [10px]       : 라벨, 네비게이션
  [9px]        : 메타 정보, 상태 텍스트
  [8px]        : 초소형 라벨
```

### Physical Interaction (Data Sonification)

#### Tone.js 기반 오디오 시스템

```
┌─────────────────────────────────────────────────────────────────┐
│                   DATA SONIFICATION SYSTEM                     │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  AUDIO ENGINE                                                   │
│  ────────────────────────────────────────────────────────────  │
│                                                                 │
│  PolySynth (Sine Wave)                                          │
│     │                                                           │
│     ▼                                                           │
│  Lowpass Filter (800Hz 기본)                                     │
│     │                                                           │
│     ▼                                                           │
│  Reverb (4초 decay, 50% wet)                                    │
│     │                                                           │
│     ▼                                                           │
│  Master Volume (-12dB)                                          │
│                                                                 │
│  DATA → SOUND MAPPING                                           │
│  ────────────────────────────────────────────────────────────  │
│                                                                 │
│  Institutional (80+)   →  Bass Notes (C2, G2)                   │
│  Institutional (50-80) →  Mid-Bass Notes (D2, A2)               │
│  Institutional (<50)   →  Low Notes (E2)                        │
│                                                                 │
│  Market Value (90+)    →  High Notes (G5, B5)                   │
│  Market Value (70-90)  →  Mid-High Notes (E5, G5)               │
│  Market Value (<70)    →  Mid Notes (C5)                        │
│                                                                 │
│  Critical Acclaim (80+) → Harmony Notes (C4, E4)                │
│                                                                 │
│  SCROLL MODULATION                                             │
│  ────────────────────────────────────────────────────────────  │
│                                                                 │
│  스크롤 속도 → Filter Frequency (800Hz ~ 2800Hz)               │
│  느린 스크롤: 은은한 배경음                                     │
│  빠른 스크롤: 밝은 고음 강조                                    │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

**인터랙션 설명:**
- Timeline Journey 진입 시 자동 재생
- 스크롤 속도에 따라 필터 주파수 조절
- 메트릭 값에 따라 음높이 및 화음 변화
- 은은한 배경음으로 몰입감 향상

### 사용자 체험 영상 / 사진

#### 주요 인터랙션 시나리오

**시나리오 1: 아티스트 검색 및 탐색**

```
1. 랜딩 페이지 진입
   └─ 브랜드 타이포그래피 페이드인 애니메이션

2. 검색어 입력: "Matisse"
   └─ 검색 입력 필드 포커스 효과

3. Overview 페이지 표시
   └─ 아티스트 이미지 로딩 (Wikipedia/Google CSE)
   └─ 레이더 차트 페이드인
   └─ 트라젝토리 차트 애니메이션

4. 레이더 차트 축 클릭: "Market Value"
   └─ Masterpiece Carousel Modal 표시
   └─ 작품 이미지 로딩 (Google Custom Search Image API)

5. 레이더 차트 포인트 클릭
   └─ Metric Insight Modal 표시
   └─ AI 생성 인사이트 타이핑 효과
```

**시나리오 2: 아티스트 비교 분석**

```
1. Connected 탭 이동
   └─ 아티스트 그리드 뷰 표시 (5-Column, 무한 스크롤)

2. 아티스트 카드 클릭: "Jean-Michel Basquiat"
   └─ Expanded View 진입 (Sticky Stacking)
   └─ Shared Element Transition 애니메이션

3. Dual Radar Chart 확인
   └─ 두 아티스트 메트릭 비교 시각화
   └─ Most Similar Axis 자동 강조

4. Trajectory Tunnel 스크롤
   └─ 가로 스크롤 파노라마 뷰
   └─ 파티클 효과 + 스포트라이트
   └─ 메트릭 버튼 클릭으로 전환

5. Comparative Analysis 읽기
   └─ AI 생성 비교 리포트 표시
   └─ Grounding Source 링크 확인
```

**시나리오 3: 심층 연구**

```
1. Deep Dive 탭 이동
   └─ AI Report 섹션 표시

2. AI Report 읽기
   └─ 타이핑 애니메이션 감상
   └─ 리포트 완료 후 HUD 오버레이 활성화

3. Chat Interface 사용
   └─ 메트릭 칩 클릭: "INSTITUTION"
   └─ 자동 질문 생성 및 전송
   └─ AI 응답 수신 (Gemini 2.5 Flash)
   └─ Firestore에 히스토리 저장

4. Flashlight Gateway 클릭
   └─ 마스크 기반 플래시라이트 효과
   └─ Timeline Journey 진입

5. Timeline Journey 탐색
   └─ 가로 스크롤로 Era 이동
   └─ 카드 호버 시 확장 + 이미지 로딩
   └─ RippleBackground 파도 효과
   └─ Data Sonification 오디오 재생
```

---

## 8. 기술 아키텍처

### 현재 기술 스택

#### 프론트엔드
- **프레임워크**: React 19.2.0
- **언어**: TypeScript 5.8.2
- **빌드 도구**: Vite 6.2.0
- **스타일링**: Tailwind CSS (인라인)
- **차트 라이브러리**: Recharts 3.4.1
- **애니메이션**: Framer Motion 11.13.1
- **마크다운**: React Markdown 10.1.0
- **오디오**: Tone.js 14.7.77

#### 백엔드/서비스
- **서버리스**: Firebase Functions 2세대 (Node.js 22)
- **AI 서비스**: Google Gemini 2.5 Flash
- **검색 API**: Google Custom Search API
- **이미지 검색**: Wikipedia API, Google Custom Search Image API
- **데이터베이스**: Firestore (캐싱), Cloud Storage (이미지)
- **호스팅**: Firebase Hosting

#### 게임 프로모션 기능 (향후)
- **3D 렌더링**: Three.js (React Three Fiber)
- **손 추적**: MediaPipe (실제 모드) / 키보드/마우스 시뮬레이션 (목업 모드)
- **오디오**: Web Audio API

### Firebase Functions 2세대 구조

#### 엔드포인트 상세 명세

| 엔드포인트 | 목적 | 타임아웃 | 메모리 | 캐싱 전략 |
|-----------|------|---------|--------|----------|
| `getDashboardData` | 작가 대시보드 데이터 | 기본 | 기본 | Firestore (24시간 TTL) |
| `getArtistReport` | 작가 리포트 | 기본 | 기본 | Firestore (24시간 TTL) |
| `getArtistTimeline` | 작가 타임라인 | 기본 | 기본 | Firestore (24시간 TTL) |
| `getMetricInsight` | 메트릭 인사이트 | 기본 | 기본 | Firestore (24시간 TTL) |
| `getMasterpieces` | 대표작 목록 | 기본 | 기본 | Firestore (24시간 TTL) |
| `getComparativeAnalysis` | 비교 분석 | 기본 | 기본 | Firestore (24시간 TTL) |
| `getDetailedTrajectory` | 상세 궤적 | 300초 | 512MiB | Firestore (24시간 TTL) |
| `getArtistImage` | 작가 이미지 생성 | 기본 | 기본 | Firestore (24시간 TTL) |
| `getArtistList` | 작가 목록 | 120초 | 512MiB | Firestore (24시간 TTL) |
| `getChatResponse` | 채팅 응답 | 기본 | 기본 | Firestore (24시간 TTL) |

#### 보안 및 CORS 설정

```typescript
// 모든 Functions에 적용되는 보안 헤더
function setSecurityHeaders(res: any) {
  res.set({
    'X-Content-Type-Options': 'nosniff',
    'X-Frame-Options': 'DENY',
    'Access-Control-Allow-Origin': '*',
    'Access-Control-Allow-Methods': 'GET, POST, OPTIONS',
    'Access-Control-Allow-Headers': 'Content-Type'
  });
}

// Functions 2세대 CORS 설정
export const getDashboardData = onRequest({ cors: true }, async (req, res) => {
  setSecurityHeaders(res);
  // ...
});
```

### 캐싱 시스템

#### Firestore 캐싱 구조

```
캐싱 컬렉션 구조:
├── dashboard/{docId}
│   └── { value: DashboardData, timestamp: number }
├── report/{docId}
│   └── { value: ReportData, timestamp: number }
├── timeline/{docId}
│   └── { value: TimelineData, timestamp: number }
├── insight/{docId}
│   └── { value: InsightData, timestamp: number }
├── masterpieces/{docId}
│   └── { value: Masterpiece[], timestamp: number }
├── comparison/{docId}
│   └── { value: ComparisonData, timestamp: number }
├── trajectory/{docId}
│   └── { value: TrajectoryData, timestamp: number }
├── images/{docId}
│   └── { value: string (imageUrl), timestamp: number }
├── artists/{docId}
│   └── { value: Artist[], timestamp: number }
├── search/{docId}
│   └── { value: SearchResult[], timestamp: number }
└── chats/{chatId}
    └── { messages: Message[], artistName: string, timestamp: number }

TTL: 24시간 (86,400,000ms)
```

#### 클라이언트 사이드 캐싱

```typescript
// services/cacheService.ts
export async function getCached<T>(
  collection: string,
  docId: string
): Promise<T | null> {
  // Firestore에서 캐시 확인
  // TTL 검증 후 반환 또는 null
}

export async function setCached<T>(
  collection: string,
  docId: string,
  value: T
): Promise<void> {
  // Firestore에 캐시 저장
  // timestamp와 함께 저장
}
```

#### Request Deduplication

```typescript
// services/requestDeduplication.ts
const pendingRequests = new Map<string, Promise<any>>();

export function deduplicateRequest<T>(
  key: string,
  fn: () => Promise<T>
): Promise<T> {
  // 동일한 요청이 진행 중이면 기존 Promise 반환
  // 없으면 새 요청 시작
}
```

### API 최적화 전략

#### Google Custom Search API 통합

```typescript
// functions/src/utils/googleSearch.ts
export async function performGoogleSearch(
  query: string,
  apiKey: string,
  searchEngineId: string,
  numResults: number = 5
): Promise<SearchResult[]> {
  // Firestore 캐시 확인
  // 캐시 미스 시 Google Custom Search API 호출
  // 결과 캐싱 후 반환
}
```

#### 병렬 데이터 로딩

```typescript
// ConnectedTab.tsx에서 병렬 로딩
const [comparisonResult, trajectoryData, masterpieces] = await Promise.all([
  generateComparativeAnalysis(artist1, artist2),
  generateDetailedTrajectory(artist1, artist2),
  fetchMasterpiecesByMetric(artistName, metric)
]);
```

---

## 9. 게임 프로모션 기능 통합

### 27 Combinations 랭킹 시스템

#### Phase 구조

**Phase 1: 초기 경력 (Early Career Volatility)**
- A. 스캔들/논란 (Scandal-driven)
- B. 조기 인정 (Early Recognition)
- C. 아웃사이더 (Outsider Path)

**Phase 2: 중기 발전 (Mid-Career Trajectory)**
- A. 제도권 편입 (Institutional Integration)
- B. 비평적 우위 (Critical Dominance)
- C. 시장 재정비 (Market Restructuring)

**Phase 3: 후기 성과 (Late-Career Outcome)**
- A. 국내 정상 (Domestic Peak)
- B. 국제적 거장 (International Master)
- C. 사후 재평가 (Posthumous Revaluation)

#### 랭킹 계산 공식

```typescript
// 의사 코드
finalRank = 
  (phase1_weight × phase1_score) +
  (phase2_weight × phase2_score) +
  (phase3_weight × phase3_score) +
  (radar_total × radar_weight)

// 가중치 분배
phase1_weight = 0.20  // 초기 경력: 20%
phase2_weight = 0.30  // 중기 발전: 30%
phase3_weight = 0.30  // 후기 성과: 30%
radar_weight = 0.20   // Radar Total: 20%
```

#### 내러티브별 점수 매핑

| Phase 1 | Score | Phase 2 | Score | Phase 3 | Score |
|---------|-------|---------|-------|---------|-------|
| Scandal | 60-75 | Institutional | 80-90 | Domestic | 70-80 |
| Recognition | 80-95 | Critical | 85-95 | International | 90-100 |
| Outsider | 50-70 | Restructuring | 60-80 | Posthumous | 75-90 |

### Tier 및 Axis 시스템

#### Tier 시스템

| Tier | 형태 | 점수 | 빈도 | 설명 |
|------|------|------|------|------|
| **TIER_1 (Masterpiece)** | 정십이면체 | 10점 | 5-10% | 최고 등급 작품 |
| **TIER_2 (Exhibition)** | 박스 | 5점 | 20-30% | 전시 작품 |
| **TIER_3 (Sketch)** | 원뿔 | 2점 | 60-75% | 스케치/연구 작품 |

#### Axis 시스템

| Axis | 색상 | 설명 | 웹 애플리케이션 활용 |
|------|------|------|---------------------|
| **INSTITUTION** | #28317C (Deep Royal Blue) | 기관 | 레이더 차트 Institution 메트릭 |
| **ACADEMIC** | #E5E5E5 (Mist Gray) | 학술 | 레이더 차트 Historical 메트릭 |
| **DISCOURSE** | #0A0A0A (Void Black) | 담론 | 레이더 차트 Critical Acclaim 메트릭 |
| **NETWORK** | #3B82F6 (Azure Blue) | 네트워크 | 레이더 차트 Social Impact 메트릭 |

### 게임 진입점 및 웹 연동

#### 통합 방식

```
웹 애플리케이션
│
├── Overview Page
│   └── Global Rank 표시 (#{rank})
│       └── 클릭 시 Rank Explanation Modal
│           └── "27 Combinations 랭킹 시스템" 설명
│               └── [게임 체험하기] 버튼
│
├── Connected Page
│   └── 아티스트 비교 분석
│       └── Tier/Axis 시스템 시각화
│           └── [게임으로 개념 학습하기] 버튼
│
└── 게임 프로모션 기능
    ├── 게임 진입점 (웹 애플리케이션 내)
    ├── 27 Combinations 랭킹 시스템
    ├── Tier/Axis 시스템 시각화
    └── 게임 결과를 웹 애플리케이션에 반영
```

#### 게임 결과 연동

- 게임 플레이 결과를 웹 애플리케이션의 랭킹 시스템에 반영 (향후 구현)
- Tier/Axis 시스템을 통한 작품 분류 학습
- Gate 선택을 통한 큐레이터 역할 체험

---

## 10. 백엔드 로직 및 최적화 전략

### 10.1 Firebase Functions 2세대 구조

#### 환경 변수 관리

```typescript
// functions/src/index.ts
const geminiApiKeyParam = defineString("GEMINI_API_KEY", {
  default: "",
});

const googleCseApiKeyParam = defineString("GOOGLE_CSE_API_KEY", {
  default: "",
});

const googleCseIdParam = defineString("GOOGLE_CSE_ID", {
  default: "",
});

// 다중 소스에서 API 키 가져오기
function getApiKey(): string {
  // 1. defineString (환경 변수)
  // 2. functions.config() (레거시)
  // 3. process.env
}
```

#### 에러 처리 및 폴백 전략

```typescript
// 계층화된 폴백 전략
try {
  // 1차: Gemini API 호출
  const response = await ai.models.generateContent({...});
} catch (error) {
  // 2차: Firestore 캐시 확인
  const cached = await getCached("dashboard", cacheKey);
  if (cached) return cached;
  
  // 3차: Mock 데이터 반환
  return mockDashboardData;
}
```

### 10.2 캐싱 전략

#### 10.2.1 서버 사이드 캐싱 (Firebase Functions)

```typescript
// functions/src/utils/cache.ts
const CACHE_TTL = 24 * 60 * 60 * 1000; // 24시간

export async function getCached<T>(
  collection: string,
  docId: string
): Promise<T | null> {
  // Firestore에서 캐시 확인
  // TTL 검증 후 반환 또는 삭제
}

export async function setCached<T>(
  collection: string,
  docId: string,
  value: T
): Promise<void> {
  // Firestore에 캐시 저장
  // timestamp와 함께 저장
}
```

#### 10.2.2 클라이언트 사이드 캐싱

```typescript
// services/cacheService.ts
export async function getCached<T>(
  collection: string,
  docId: string
): Promise<T | null> {
  // Firestore 클라이언트 SDK로 캐시 확인
}

export async function setCached<T>(
  collection: string,
  docId: string,
  value: T
): Promise<void> {
  // Firestore 클라이언트 SDK로 캐시 저장
}
```

### 10.3 지수 백오프 전략 (Exponential Backoff)

#### 10.3.1 현재 문제점

현재 캐시 미스 시 즉시 AI 호출로, Rate Limit 또는 일시적 오류 발생 시 재시도 메커니즘이 없어 사용자 경험이 저하됩니다.

#### 10.3.2 구현 전략

```typescript
// functions/src/utils/retryStrategy.ts

interface RetryConfig {
  maxRetries: number;
  baseDelay: number;      // ms
  maxDelay: number;       // ms
  backoffFactor: number;
  jitter: boolean;       // Thundering herd 방지
}

const GEMINI_RETRY_CONFIG: RetryConfig = {
  maxRetries: 3,
  baseDelay: 1000,      // 1초
  maxDelay: 32000,      // 32초 최대
  backoffFactor: 2,     // 2배씩 증가
  jitter: true
};

export async function withExponentialBackoff<T>(
  fn: () => Promise<T>,
  config: RetryConfig = GEMINI_RETRY_CONFIG
): Promise<T> {
  let lastError: Error;
  
  for (let attempt = 0; attempt <= config.maxRetries; attempt++) {
    try {
      return await fn();
    } catch (error) {
      lastError = error as Error;
      
      // 재시도 가능한 에러인지 확인
      if (!isRetryableError(error)) {
        throw error;
      }
      
      // 마지막 시도면 에러 throw
      if (attempt === config.maxRetries) {
        throw lastError;
      }
      
      // 지수 백오프 계산
      const delay = Math.min(
        config.baseDelay * Math.pow(config.backoffFactor, attempt),
        config.maxDelay
      );
      
      // Jitter 추가 (thundering herd 방지)
      const jitteredDelay = config.jitter
        ? delay * (0.5 + Math.random() * 0.5)
        : delay;
      
      logger.warn(`Retry attempt ${attempt + 1}/${config.maxRetries} after ${jitteredDelay}ms`);
      await sleep(jitteredDelay);
    }
  }
  
  throw lastError!;
}

function isRetryableError(error: any): boolean {
  const retryableCodes = [429, 503, 504]; // Rate limit, Service unavailable, Gateway timeout
  const retryableMessages = [
    'RESOURCE_EXHAUSTED',
    'UNAVAILABLE',
    'DEADLINE_EXCEEDED',
    'ECONNREFUSED',
    'ERR_CONNECTION_REFUSED',
    'Failed to fetch'
  ];
  
  return (
    retryableCodes.includes(error.status) ||
    retryableMessages.some(msg => error.message?.includes(msg))
  );
}

const sleep = (ms: number) => new Promise(resolve => setTimeout(resolve, ms));
```

#### 10.3.3 적용 예시

```typescript
// functions/src/index.ts - getDashboardData 수정
export const getDashboardData = onRequest({ cors: true }, async (req, res) => {
  setSecurityHeaders(res);
  
  const artistName = req.query.artistName as string;
  if (!artistName) {
    res.status(400).json({ error: "artistName required" });
    return;
  }

  try {
    // 캐시 확인
    const cacheKey = `dashboard:${artistName}`;
    const cached = await getCached<any>("dashboard", cacheKey);
    if (cached) {
      logger.info(`Cache hit for dashboard: ${artistName}`);
      res.json(cached);
      return;
    }

    // 지수 백오프로 AI 호출
    const ai = getAI();
    const dataResponse = await withExponentialBackoff(async () => {
      return await ai.models.generateContent({
        model: 'gemini-2.5-flash',
        contents: `Generate dashboard data for artist: ${artistName}...`,
        config: { tools: [{ googleSearch: {} }] }
      });
    });
    
    // 데이터 처리 및 캐싱
    const dashboardData = processDashboardResponse(dataResponse);
    await setCached("dashboard", cacheKey, dashboardData);
    res.json(dashboardData);
    
  } catch (error) {
    logger.error("Dashboard data error:", error);
    // 폴백 데이터 반환
    res.json(fallbackDashboardData);
  }
});
```

### 10.4 3-Tier 스토리지 아키텍처

#### 10.4.1 아키텍처 개요

현재 24시간 TTL 기반 캐싱은 동일한 아티스트에 대해 24시간 후 재요청 시 AI 호출이 반복됩니다. 이를 해결하기 위해 영구 저장 계층을 추가하여 비용을 최적화합니다.

```
┌─────────────────────────────────────────────────────────────────┐
│                 3-TIER STORAGE ARCHITECTURE                     │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────┐                                           │
│  │   TIER 1        │  Memory Cache (Cloud Memorystore - Optional)│
│  │   HOT CACHE     │  TTL: 1시간                               │
│  │   (Optional)    │  용도: 자주 조회되는 아티스트             │
│  └────────┬────────┘                                           │
│           │ Cache Miss                                          │
│           ▼                                                     │
│  ┌─────────────────┐                                           │
│  │   TIER 2        │  Firestore Session Cache                  │
│  │   WARM CACHE    │  TTL: 24시간                              │
│  │                 │  용도: 세션 캐시                          │
│  └────────┬────────┘                                           │
│           │ Cache Miss                                          │
│           ▼                                                     │
│  ┌─────────────────┐                                           │
│  │   TIER 3        │  Firestore Knowledge Base                 │
│  │   PERMANENT     │  TTL: 없음 (영구)                         │
│  │   STORAGE       │  용도: AI 생성 데이터 영구 보관           │
│  └────────┬────────┘                                           │
│           │ Knowledge Miss (처음 요청)                          │
│           ▼                                                     │
│  ┌─────────────────┐                                           │
│  │   AI SERVICE    │  Gemini 2.5 Flash                         │
│  │   (Only when    │  + Google Custom Search                   │
│  │   truly needed) │                                           │
│  └─────────────────┘                                           │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

#### 10.4.2 Firestore 컬렉션 구조 개선

```typescript
// 영구 데이터 저장을 위한 새 컬렉션 구조

// 1. artists_knowledge (영구 저장)
interface ArtistKnowledge {
  artistName: string;           // Primary key (정규화된 이름)
  normalizedName: string;       // 검색용 정규화 이름 (소문자, 공백 제거)
  
  // 기본 정보 (거의 변하지 않음)
  basicInfo: {
    nationality: string;
    birthYear: number;
    deathYear?: number;
    movements: string[];
    majorWorks: string[];
  };
  
  // AI 생성 메트릭 (주기적 업데이트)
  metrics: {
    radarData: AxisData[];
    trajectory: TimeSeriesPoint[];
    lastUpdated: Timestamp;
    updateFrequency: 'monthly' | 'quarterly' | 'yearly';
  };
  
  // AI 생성 리포트 (버전 관리)
  reports: {
    curatorial: {
      text: string;
      version: number;
      generatedAt: Timestamp;
    };
    timeline: TimelineData;
  };
  
  // 메타데이터
  metadata: {
    createdAt: Timestamp;
    lastAccessed: Timestamp;
    accessCount: number;
    dataQuality: 'verified' | 'ai_generated' | 'user_contributed';
  };
}

// 2. comparison_knowledge (영구 저장 - 비교 분석도 재사용 가치 높음)
interface ComparisonKnowledge {
  artistPair: string;           // "artist1:artist2" (정렬된 순서)
  comparison: AIReportResult;
  trajectory: ComparativeTrajectory;
  generatedAt: Timestamp;
  lastAccessed: Timestamp;
}

// 3. search_cache (24시간 TTL - 현재 유지)
interface SearchCache {
  query: string;
  results: SearchResult[];
  timestamp: Timestamp;
}
```

#### 10.4.3 조회 로직 개선

```typescript
// functions/src/utils/knowledgeBase.ts

export async function getArtistData(artistName: string): Promise<{
  data: ArtistKnowledge;
  source: 'memory' | 'cache' | 'knowledge' | 'ai';
}> {
  const normalizedName = normalizeArtistName(artistName);
  
  // TIER 1: Memory Cache (Optional - Cloud Memorystore)
  // const memCached = await memoryCache.get(`artist:${normalizedName}`);
  // if (memCached) return { data: memCached, source: 'memory' };
  
  // TIER 2: Firestore Session Cache (24시간)
  const sessionCached = await getCached<ArtistKnowledge>('dashboard', normalizedName);
  if (sessionCached) {
    // Memory cache에 저장 (Optional)
    // await memoryCache.set(`artist:${normalizedName}`, sessionCached, 3600);
    return { data: sessionCached, source: 'cache' };
  }
  
  // TIER 3: Firestore Knowledge Base (영구)
  const knowledge = await getKnowledge('artists_knowledge', normalizedName);
  if (knowledge) {
    // 데이터 신선도 확인
    if (isDataFresh(knowledge.metrics.lastUpdated, knowledge.metrics.updateFrequency)) {
      // Session cache에 저장
      await setCached('dashboard', normalizedName, knowledge);
      // 접근 기록 업데이트
      await updateAccessRecord('artists_knowledge', normalizedName);
      return { data: knowledge, source: 'knowledge' };
    }
    
    // 오래된 데이터면 백그라운드 업데이트 트리거
    triggerBackgroundUpdate(normalizedName);
    // 일단 기존 데이터 반환 (Stale-While-Revalidate 패턴)
    await setCached('dashboard', normalizedName, knowledge);
    return { data: knowledge, source: 'knowledge' };
  }
  
  // TIER 4: AI 생성 (완전히 새로운 아티스트)
  const aiData = await generateArtistDataWithAI(artistName);
  
  // 모든 계층에 저장
  await saveToKnowledgeBase('artists_knowledge', normalizedName, aiData);
  await setCached('dashboard', normalizedName, aiData);
  
  return { data: aiData, source: 'ai' };
}

function normalizeArtistName(name: string): string {
  return name.toLowerCase().trim().replace(/\s+/g, '_');
}

function isDataFresh(lastUpdated: Timestamp, frequency: string): boolean {
  const now = Date.now();
  const age = now - lastUpdated.toMillis();
  
  const freshnessThresholds = {
    'monthly': 30 * 24 * 60 * 60 * 1000,    // 30일
    'quarterly': 90 * 24 * 60 * 60 * 1000,  // 90일
    'yearly': 365 * 24 * 60 * 60 * 1000     // 365일
  };
  
  return age < (freshnessThresholds[frequency] || freshnessThresholds.monthly);
}

async function triggerBackgroundUpdate(artistName: string): Promise<void> {
  // Cloud Tasks 또는 Pub/Sub로 백그라운드 업데이트 트리거
  // 사용자 응답을 블로킹하지 않음
  logger.info(`Background update triggered for: ${artistName}`);
}
```

### 10.5 로딩 시간 최적화 전략

#### 10.5.1 프리로딩 전략

```typescript
// 클라이언트 사이드: Connected Tab 진입 시 예측 프리로딩
const usePrefetch = (referenceArtist: string, visibleArtists: Artist[]) => {
  useEffect(() => {
    // 화면에 보이는 아티스트들에 대해 비교 데이터 미리 로딩
    const prefetchQueue = visibleArtists.slice(0, 5); // 상위 5명만
    
    prefetchQueue.forEach(artist => {
      // Priority Queue 기반 프리로딩
      requestIdleCallback(() => {
        prefetchComparison(referenceArtist, artist.name);
      });
    });
  }, [referenceArtist, visibleArtists]);
};

async function prefetchComparison(artist1: string, artist2: string): Promise<void> {
  // 캐시 확인 후 없으면 백그라운드 로딩
  const cacheKey = `comparison:${artist1}:${artist2}`;
  const cached = await getCached('comparison', cacheKey);
  if (!cached) {
    // 낮은 우선순위로 요청
    fetch(`${FUNCTIONS_URL}/getComparativeAnalysis?artist1=${artist1}&artist2=${artist2}`, {
      priority: 'low'
    });
  }
}
```

#### 10.5.2 점진적 로딩 (Streaming Response)

```typescript
// functions/src/index.ts - Streaming Trajectory
export const getDetailedTrajectoryStreaming = onRequest({
  cors: true,
  timeoutSeconds: 120, // 타임아웃 단축
}, async (req, res) => {
  setSecurityHeaders(res);
  
  const artist1 = req.query.artist1 as string;
  const artist2 = req.query.artist2 as string;
  
  if (!artist1 || !artist2) {
    res.status(400).json({ error: "artist1 and artist2 required" });
    return;
  }

  try {
    // SSE (Server-Sent Events) 설정
    res.setHeader('Content-Type', 'text/event-stream');
    res.setHeader('Cache-Control', 'no-cache');
    res.setHeader('Connection', 'keep-alive');
    
    // 1단계: 기본 구조 먼저 반환
    const basicStructure = await getBasicTrajectoryStructure(artist1, artist2);
    res.write(`data: ${JSON.stringify({ type: 'structure', data: basicStructure })}\n\n`);
    
    // 2단계: 상세 데이터 점진적 반환
    const ageGroups = [[20, 30], [30, 40], [40, 50], [50, 60], [60, 70], [70, 80]];
    for (const [startAge, endAge] of ageGroups) {
      const detailData = await getTrajectoryForAgeGroup(artist1, artist2, startAge, endAge);
      res.write(`data: ${JSON.stringify({ type: 'detail', ageRange: [startAge, endAge], data: detailData })}\n\n`);
    }
    
    res.write('data: [DONE]\n\n');
    res.end();
  } catch (error) {
    logger.error("Streaming trajectory error:", error);
    res.write(`data: ${JSON.stringify({ type: 'error', message: error.message })}\n\n`);
    res.end();
  }
});
```

#### 10.5.3 스마트 캐싱 전략

```typescript
// services/smartCache.ts

interface CacheStrategy {
  key: string;
  ttl: number;
  priority: 'high' | 'medium' | 'low';
  refreshInBackground: boolean;
}

const CACHE_STRATEGIES: Record<string, CacheStrategy> = {
  dashboard: {
    key: 'dashboard',
    ttl: 24 * 60 * 60 * 1000,      // 24시간
    priority: 'high',
    refreshInBackground: false
  },
  trajectory: {
    key: 'trajectory',
    ttl: 7 * 24 * 60 * 60 * 1000,  // 7일 (비용 절감)
    priority: 'medium',
    refreshInBackground: true       // 백그라운드 갱신
  },
  comparison: {
    key: 'comparison',
    ttl: 30 * 24 * 60 * 60 * 1000, // 30일 (거의 안 변함)
    priority: 'low',
    refreshInBackground: true
  },
  report: {
    key: 'report',
    ttl: 7 * 24 * 60 * 60 * 1000,   // 7일
    priority: 'medium',
    refreshInBackground: true
  }
};

export async function getCachedWithStrategy<T>(
  strategyKey: string,
  docId: string
): Promise<{ data: T | null; source: string }> {
  const strategy = CACHE_STRATEGIES[strategyKey];
  if (!strategy) {
    throw new Error(`Unknown cache strategy: ${strategyKey}`);
  }
  
  // 캐시 확인
  const cached = await getCached<T>(strategy.key, docId);
  if (cached) {
    return { data: cached, source: 'cache' };
  }
  
  // Knowledge Base 확인 (영구 저장)
  if (strategyKey === 'dashboard' || strategyKey === 'comparison') {
    const knowledge = await getKnowledge(strategy.key, docId);
    if (knowledge) {
      // Stale-While-Revalidate 패턴
      if (strategy.refreshInBackground) {
        triggerBackgroundRefresh(strategyKey, docId);
      }
      return { data: knowledge, source: 'knowledge' };
    }
  }
  
  return { data: null, source: 'miss' };
}
```

### 10.6 비용 최적화 전략

#### 10.6.1 API 호출 비용 분석

| 호출 유형 | 예상 비용/호출 | 최적화 방안 | 목표 절감률 |
|----------|--------------|------------|-----------|
| **Gemini 2.5 Flash** | $0.0005 | 영구 저장 + 백그라운드 갱신 | 80% |
| **Google CSE** | $0.005 | 캐싱 (24시간) | 70% |
| **Google CSE Image** | $0.005 | Wikipedia 우선 + 캐싱 | 90% |
| **Imagen 4.0** | $0.02 | 실제 이미지 우선 + 캐싱 | 90% |

#### 10.6.2 비용 절감 시나리오

```
시나리오: 월간 10,000명 사용자, 아티스트당 평균 3회 조회

현재 구조 (24시간 TTL):
- AI 호출: 10,000명 × 3회 = 30,000회
- 비용: 30,000 × $0.0005 = $15/월

개선 구조 (영구 저장 + 백그라운드 갱신):
- 신규 아티스트: 1,000명 (월간)
- 재조회: 29,000회 (Knowledge Base에서 제공)
- 비용: 1,000 × $0.0005 = $0.5/월
- 절감률: 96.7%
```

#### 10.6.3 영구 데이터 저장 정책

| 데이터 유형 | 저장 계층 | TTL | 갱신 주기 | 비고 |
|------------|---------|-----|----------|------|
| **아티스트 기본 정보** | Knowledge Base | 영구 | 수동 검증 | 거의 변하지 않음 |
| **AI 생성 메트릭** | Knowledge Base | 영구 | 월간/분기별 | 주기적 업데이트 |
| **비교 분석** | Knowledge Base | 영구 | 분기별 | 조합별 영구 저장 |
| **타임라인** | Knowledge Base | 영구 | 연간 | 역사적 데이터 |
| **검색 결과** | Session Cache | 24시간 | - | 실시간성 중요 |
| **채팅 히스토리** | Firestore | 영구 | - | 사용자별 저장 |

### 10.7 에러 핸들링 표준화

```typescript
// functions/src/utils/errorHandler.ts

interface ErrorResponse {
  error: string;
  fallbackData?: any;
  retryAfter?: number;
  source: 'ai' | 'cache' | 'knowledge' | 'fallback';
}

export async function handleApiError<T>(
  error: any,
  fallbackData: T,
  retryConfig?: RetryConfig
): Promise<ErrorResponse> {
  logger.error("API Error:", error);
  
  // 재시도 가능한 에러인지 확인
  if (isRetryableError(error) && retryConfig) {
    const retryAfter = calculateRetryDelay(error, retryConfig);
    return {
      error: error.message,
      retryAfter,
      source: 'ai'
    };
  }
  
  // 폴백 데이터 반환
  return {
    error: error.message,
    fallbackData,
    source: 'fallback'
  };
}

// 모든 Functions에 적용
export const getDashboardData = onRequest({ cors: true }, async (req, res) => {
  try {
    // ... 기존 로직
  } catch (error) {
    const errorResponse = await handleApiError(
      error,
      mockDashboardData,
      GEMINI_RETRY_CONFIG
    );
    
    if (errorResponse.fallbackData) {
      res.json(errorResponse.fallbackData);
    } else {
      res.status(503).json(errorResponse);
    }
  }
});
```

### 10.8 API 최적화

#### 10.8.1 Google Custom Search API 우선 사용

```typescript
// getDetailedTrajectory에서 Google Custom Search API 우선 사용
// Gemini의 Search Grounding보다 빠름
const searchResults = await performGoogleSearch(
  `${artist1} ${artist2} trajectory`,
  cseApiKey,
  cseId
);
const searchContext = formatSearchResultsAsContext(searchResults);
```

#### 10.8.2 Request Deduplication

```typescript
// services/requestDeduplication.ts
export function deduplicateRequest<T>(
  key: string,
  fn: () => Promise<T>
): Promise<T> {
  if (pendingRequests.has(key)) {
    return pendingRequests.get(key)!;
  }
  
  const promise = fn().finally(() => {
    pendingRequests.delete(key);
  });
  
  pendingRequests.set(key, promise);
  return promise;
}
```

---

## 11. 사용자 가치 및 성공 지표

### 사용자 가치

#### 즉각적 가치 (Immediate Value)

- **통합된 정보**: 분산된 아티스트 정보를 한 곳에서 확인
- **실시간 업데이트**: 최신 경매 결과, 전시 정보 반영
- **신뢰할 수 있는 소스**: Grounding Source 투명성
- **직관적 비교**: 레이더 차트와 트라젝토리 차트로 즉각적 패턴 인식
- **재미있는 학습**: 게임을 통한 예술 개념 이해

#### 중기 가치 (Medium-term Value)

- **수집 전략**: 컬렉터의 작품 수집 전략 수립 지원
- **전시 기획**: 큐레이터의 아티스트 선택 및 전시 구성
- **연구 효율성**: 아티스트 비교 분석 시간 단축
- **새로운 발견**: Connected 페이지를 통한 유사 아티스트 탐색
- **체험적 학습**: 게임을 통한 큐레이터 역할 이해

#### 장기 가치 (Long-term Value)

- **전문성 향상**: AI 리포트를 통한 큐레이토리얼 인사이트 습득
- **시장 이해**: 트라젝토리 분석을 통한 미술 시장 동향 이해
- **접근성 향상**: 일반 사용자도 전문적 분석 도구 활용
- **네트워크 효과**: 공통 관심사를 가진 사용자 간 연결
- **예술 교육**: 게임을 통한 예술 교육 도구로서의 가치

### 성공 지표 (KPI)

#### 사용자 지표
- **월간 활성 사용자 (MAU)**
- **세션당 페이지뷰**
- **평균 세션 시간**
- **이탈률**

#### 기능별 지표
- **차트 인터랙션율**: 레이더 차트 클릭률
- **비교 분석 생성률**: Connected 페이지에서 비교 뷰 진입률
- **Deep Dive 완료율**: 리포트 읽기 완료율
- **Chat 사용률**: 채팅 인터페이스 사용 빈도
- **게임 플레이율**: 게임 프로모션 기능 사용률 (향후)

#### 비즈니스 지표
- **API 호출 비용**: Gemini API 사용량 및 비용
- **캐시 히트율**: Firestore 캐시 효율성
- **사용자 만족도**: 피드백 및 리뷰 점수
- **재방문율**: 사용자 재방문 빈도

---

## 12. 위험 요소 및 대응 방안

### 기술적 위험

#### API 비용 증가
- **위험**: 사용자 증가에 따른 Gemini API 비용 상승
- **대응**: 
  - Firestore 기반 24시간 TTL 캐싱 (현재 구현됨)
  - **3-Tier 스토리지 아키텍처**: 영구 저장 계층 추가로 재조회 시 AI 호출 제거 (목표: 80% 비용 절감)
  - Request Deduplication으로 중복 요청 방지 (현재 구현됨)
  - Google Custom Search API 우선 사용으로 Gemini 호출 감소 (현재 구현됨)
  - 지수 백오프 전략으로 불필요한 재시도 방지 (계획됨)

#### 데이터 정확도
- **위험**: AI 생성 콘텐츠의 정확도 문제
- **대응**: 
  - Grounding Source 표시로 정보 출처 투명성 확보 (현재 구현됨)
  - 사용자 피드백 수집 (향후 계획)

#### Firebase Functions 타임아웃
- **위험**: 긴 작업 시간으로 인한 타임아웃
- **대응**: 
  - `getDetailedTrajectory`: 타임아웃 300초, 메모리 512MiB (현재 구현됨)
  - `getDetailedTrajectoryStreaming`: 점진적 로딩으로 타임아웃 120초로 단축 (계획됨)
  - `getArtistList`: 타임아웃 120초, 메모리 512MiB (현재 구현됨)
  - Google Custom Search API 우선 사용으로 응답 시간 단축 (현재 구현됨)
  - 프리로딩 전략으로 사용자 경험 개선 (계획됨)

### 사용자 경험 위험

#### 로딩 시간
- **위험**: API 응답 지연으로 인한 사용자 이탈
- **대응**: 
  - 로딩 인디케이터 개선 (Nautical Spinner)
  - 폴백 데이터 제공 (Mock 데이터)
  - Firestore 캐싱으로 응답 시간 단축
  - **점진적 로딩 (Streaming Response)**: 기본 구조 먼저 표시 후 상세 데이터 점진적 로딩 (계획됨)
  - **프리로딩 전략**: Connected Tab 진입 시 예측 프리로딩으로 대기 시간 감소 (계획됨)
  - **3-Tier 스토리지**: 영구 저장 계층에서 즉시 응답 가능 (계획됨)

#### 복잡성
- **위험**: 기능이 많아 사용자가 혼란스러울 수 있음
- **대응**: 
  - 온보딩 튜토리얼 추가 (향후 계획)
  - 도움말 섹션 강화 (향후 계획)

### 게임 프로모션 기능 위험

#### 구현 복잡도
- **위험**: 게임 기능 통합의 기술적 복잡도
- **대응**: 
  - 단계적 구현 (Phase 1: 기본 게임플레이, Phase 2: 웹 연동)
  - 기존 Tier/Axis 시스템 재사용

---

## 13. 게임-웹 통합 아키텍처

### 13.1 GCP 생태계 기반 게임 아키텍처

게임 프로모션 기능은 웹 애플리케이션과 완전히 통합되어, 게임 플레이 결과가 웹의 데이터와 인사이트에 영향을 미치고, 웹에서 탐색한 아티스트 정보가 게임 경험을 풍부하게 만듭니다.

```
┌─────────────────────────────────────────────────────────────────┐
│                  GAME ARCHITECTURE (GCP)                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    CLIENT (Web)                          │   │
│  │  React + Three.js (React Three Fiber)                   │   │
│  │  + MediaPipe (Hand Tracking)                            │   │
│  └────────────────────┬────────────────────────────────────┘   │
│                       │                                         │
│  ┌────────────────────▼────────────────────────────────────┐   │
│  │              FIREBASE HOSTING                            │   │
│  │              (Static Assets + Game Bundle)               │   │
│  └────────────────────┬────────────────────────────────────┘   │
│                       │                                         │
│  ┌────────────────────▼────────────────────────────────────┐   │
│  │              CLOUD FUNCTIONS                             │   │
│  │  ├─ getGameSession()    (게임 세션 생성)                │   │
│  │  ├─ submitScore()       (점수 제출)                     │   │
│  │  ├─ getLeaderboard()    (리더보드)                      │   │
│  │  └─ syncProgress()      (27 Combinations 진행 동기화)   │   │
│  └────────────────────┬────────────────────────────────────┘   │
│                       │                                         │
│  ┌────────────────────▼────────────────────────────────────┐   │
│  │              FIRESTORE                                   │   │
│  │  ├─ game_sessions/{sessionId}                          │   │
│  │  ├─ leaderboards/{artistName}                           │   │
│  │  ├─ user_progress/{userId}                              │   │
│  │  └─ 27combinations_unlocks/{userId}                     │   │
│  └────────────────────┬────────────────────────────────────┘   │
│                       │                                         │
│  ┌────────────────────▼────────────────────────────────────┐   │
│  │              CLOUD STORAGE                               │   │
│  │  ├─ Game Assets (3D Models, Textures)                  │   │
│  │  ├─ Audio Files (Music, SFX)                            │   │
│  │  └─ Generated Images (Imagen 4.0)                      │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 13.2 27 Combinations 시스템 - 웹 연동

#### 13.2.1 통합 데이터 모델

27 Combinations 시스템은 게임과 웹 애플리케이션 양쪽에서 작동하며, 게임에서 해금한 조합은 웹에서 추가 인사이트를 제공하고, 웹에서 탐색한 아티스트는 게임에서 자동으로 분류됩니다.

```typescript
// types.ts 확장

interface NarrativeCombination {
  phase1: 'SCANDAL' | 'RECOGNITION' | 'OUTSIDER';
  phase2: 'INSTITUTIONAL' | 'CRITICAL' | 'RESTRUCTURING';
  phase3: 'DOMESTIC' | 'INTERNATIONAL' | 'POSTHUMOUS';
  
  // 이 조합의 대표 아티스트 (AI 매칭)
  representativeArtists: string[];
  
  // 게임에서 해금 가능
  unlockCondition: {
    type: 'score' | 'combo' | 'gate_selection';
    threshold: number;
  };
  
  // 웹에서 추가 인사이트 제공
  webInsights?: {
    description: string;
    relatedArtists: string[];
    trajectoryPattern: string;
  };
}

// 27개 조합 정의 예시
const NARRATIVE_COMBINATIONS: NarrativeCombination[] = [
  {
    phase1: 'SCANDAL',
    phase2: 'INSTITUTIONAL',
    phase3: 'INTERNATIONAL',
    representativeArtists: ['Damien Hirst', 'Jeff Koons'],
    unlockCondition: { type: 'score', threshold: 10000 },
    webInsights: {
      description: '초기 논란을 극복하고 제도권에 편입된 후 국제적 거장이 된 패턴',
      relatedArtists: ['Damien Hirst', 'Jeff Koons', 'Takashi Murakami'],
      trajectoryPattern: 'High Market Value, Moderate Critical Acclaim'
    }
  },
  // ... 26개 더
];
```

#### 13.2.2 아티스트 자동 분류

웹 애플리케이션에서 아티스트를 탐색하면, AI가 자동으로 27 Combinations 시스템에 분류하여 게임에서 해당 아티스트의 내러티브 경로를 활용할 수 있습니다.

```typescript
// functions/src/index.ts - 아티스트 분류 함수 추가

export const classifyArtistNarrative = onRequest({ cors: true }, async (req, res) => {
  setSecurityHeaders(res);
  
  const artistName = req.query.artistName as string;
  if (!artistName) {
    res.status(400).json({ error: "artistName required" });
    return;
  }

  try {
    // Knowledge Base에서 확인
    const knowledge = await getKnowledge('artists_knowledge', normalizeArtistName(artistName));
    if (knowledge?.narrativeCombination) {
      res.json(knowledge.narrativeCombination);
      return;
    }

    // AI로 분류
    const ai = getAI();
    const response = await withExponentialBackoff(async () => {
      return await ai.models.generateContent({
        model: 'gemini-2.5-flash',
        contents: `Classify artist "${artistName}" into the 27 Combinations narrative system:
        
        Phase 1 (Early Career): SCANDAL | RECOGNITION | OUTSIDER
        Phase 2 (Mid Career): INSTITUTIONAL | CRITICAL | RESTRUCTURING
        Phase 3 (Late Career): DOMESTIC | INTERNATIONAL | POSTHUMOUS
        
        Return JSON: { "phase1": "...", "phase2": "...", "phase3": "..." }`,
        config: { tools: [{ googleSearch: {} }] }
      });
    });
    
    const combination = JSON.parse(response.text);
    
    // Knowledge Base에 저장
    await updateKnowledge('artists_knowledge', normalizeArtistName(artistName), {
      narrativeCombination: combination
    });
    
    res.json(combination);
  } catch (error) {
    logger.error("Narrative classification error:", error);
    res.status(500).json({ error: "Classification failed" });
  }
});
```

### 13.3 게임-웹 데이터 동기화

#### 13.3.1 게임 세션 저장

게임 플레이 결과는 Firestore에 저장되며, 27 Combinations 해금 상태와 리더보드가 자동으로 업데이트됩니다.

```typescript
// functions/src/index.ts - 게임 세션 동기화

export const syncGameProgress = onRequest({ cors: true }, async (req, res) => {
  setSecurityHeaders(res);
  
  const { userId, gameSession } = req.body;
  
  if (!userId || !gameSession) {
    res.status(400).json({ error: "userId and gameSession required" });
    return;
  }

  try {
    // 게임 결과 저장
    const sessionRef = db.collection('game_sessions').doc(gameSession.id);
    await sessionRef.set({
      userId,
      score: gameSession.score,
      combo: gameSession.combo,
      completedAt: FieldValue.serverTimestamp(),
      gateSelections: gameSession.gateSelections,
      artistsEncountered: gameSession.artistsEncountered,
      narrativePath: calculateNarrativePath(gameSession.gateSelections)
    });
    
    // 27 Combinations 해금 확인
    const unlocks = calculateUnlocks(gameSession);
    if (unlocks.length > 0) {
      const userProgressRef = db.collection('user_progress').doc(userId);
      await userProgressRef.set({
        unlockedCombinations: FieldValue.arrayUnion(...unlocks),
        lastUpdated: FieldValue.serverTimestamp()
      }, { merge: true });
      
      // 웹 애플리케이션에 해금 알림
      await notifyUnlock(userId, unlocks);
    }
    
    // 리더보드 업데이트
    await updateLeaderboard(gameSession);
    
    res.json({ success: true, newUnlocks: unlocks });
  } catch (error) {
    logger.error("Game sync error:", error);
    res.status(500).json({ error: "Sync failed" });
  }
});

function calculateNarrativePath(gateSelections: GateSelection[]): string {
  // Gate 선택을 27 Combinations 경로로 변환
  const phase1 = gateSelections.find(g => g.phase === 1)?.type || 'OUTSIDER';
  const phase2 = gateSelections.find(g => g.phase === 2)?.type || 'RESTRUCTURING';
  const phase3 = gateSelections.find(g => g.phase === 3)?.type || 'POSTHUMOUS';
  return `${phase1}-${phase2}-${phase3}`;
}

function calculateUnlocks(gameSession: GameSession): string[] {
  const unlocks: string[] = [];
  
  // 점수 기반 해금
  if (gameSession.score >= 10000) {
    unlocks.push('HIGH_SCORE_UNLOCK');
  }
  
  // 콤보 기반 해금
  if (gameSession.combo >= 50) {
    unlocks.push('COMBO_MASTER');
  }
  
  // Gate 선택 기반 해금
  const narrativePath = calculateNarrativePath(gameSession.gateSelections);
  unlocks.push(narrativePath);
  
  return unlocks;
}
```

#### 13.3.2 리더보드 시스템

리더보드는 글로벌 및 아티스트별로 관리되며, 게임 점수와 웹에서의 탐색 활동이 모두 반영됩니다.

```typescript
// functions/src/index.ts - 리더보드

export const getLeaderboard = onRequest({ cors: true }, async (req, res) => {
  setSecurityHeaders(res);
  
  const artistName = req.query.artistName as string;
  const limit = parseInt(req.query.limit as string) || 10;
  
  try {
    const leaderboardRef = db.collection('leaderboards')
      .doc(artistName || 'global')
      .collection('scores')
      .orderBy('score', 'desc')
      .limit(limit);
    
    const snapshot = await leaderboardRef.get();
    const entries = snapshot.docs.map(doc => ({
      userId: doc.id,
      score: doc.data().score,
      combo: doc.data().combo,
      timestamp: doc.data().timestamp
    }));
    
    res.json({ leaderboard: entries });
  } catch (error) {
    logger.error("Leaderboard error:", error);
    res.status(500).json({ error: "Failed to fetch leaderboard" });
  }
});

async function updateLeaderboard(gameSession: GameSession): Promise<void> {
  // 글로벌 리더보드
  await db.collection('leaderboards')
    .doc('global')
    .collection('scores')
    .doc(gameSession.userId)
    .set({
      score: gameSession.score,
      combo: gameSession.combo,
      timestamp: FieldValue.serverTimestamp()
    }, { merge: true });
  
  // 아티스트별 리더보드 (게임에서 만난 아티스트)
  for (const artist of gameSession.artistsEncountered) {
    await db.collection('leaderboards')
      .doc(artist)
      .collection('scores')
      .doc(gameSession.userId)
      .set({
        score: gameSession.score,
        combo: gameSession.combo,
        timestamp: FieldValue.serverTimestamp()
      }, { merge: true });
  }
}
```

### 13.4 웹-게임 연동 플로우

```
웹 애플리케이션
│
├── Overview Page
│   └── Global Rank 표시 (#{rank})
│       └── 클릭 시 Rank Explanation Modal
│           └── "27 Combinations 랭킹 시스템" 설명
│               └── [게임으로 체험하기] 버튼
│                   └── 게임 진입 (해당 아티스트의 조합 정보 전달)
│
├── Connected Page
│   └── 아티스트 비교 분석
│       └── Tier/Axis 시스템 시각화
│           └── [게임으로 개념 학습하기] 버튼
│               └── 게임 진입 (Tier/Axis 시스템 튜토리얼)
│
└── 게임 프로모션 기능
    ├── 게임 플레이
    │   ├── Gate 선택 → 27 Combinations 경로 결정
    │   ├── 점수 달성 → 해금 조건 충족 확인
    │   └── 게임 종료 → 진행 상황 동기화
    │
    └── 웹 연동
        ├── 해금된 조합 → 웹에서 추가 인사이트 제공
        ├── 게임 점수 → 리더보드 반영
        └── 탐색한 아티스트 → 웹에서 추천 아티스트 표시
```

### 13.5 게임 데이터 구조

#### 13.5.1 게임 세션 데이터

```typescript
interface GameSession {
  id: string;
  userId: string;
  score: number;
  combo: number;
  gateSelections: GateSelection[];
  artistsEncountered: string[];
  narrativePath: string;
  completedAt: Timestamp;
}

interface GateSelection {
  phase: 1 | 2 | 3;
  type: 'SCANDAL' | 'RECOGNITION' | 'OUTSIDER' | 
        'INSTITUTIONAL' | 'CRITICAL' | 'RESTRUCTURING' |
        'DOMESTIC' | 'INTERNATIONAL' | 'POSTHUMOUS';
  timestamp: Timestamp;
}
```

#### 13.5.2 사용자 진행 상황

```typescript
interface UserProgress {
  userId: string;
  unlockedCombinations: string[];  // 해금된 27 Combinations 경로
  gameHighScores: Record<string, number>;  // 아티스트별 최고 점수
  exploredArtists: string[];  // 웹에서 탐색한 아티스트
  lastUpdated: Timestamp;
}
```

### 13.6 게임-웹 통합의 가치

#### 13.6.1 사용자 경험 향상

- **게임을 통한 학습**: Tier/Axis 시스템과 27 Combinations를 게임으로 체험하며 이해
- **웹 탐색의 보상**: 웹에서 탐색한 아티스트가 게임에서 등장하여 친숙함 제공
- **해금의 의미**: 게임에서 해금한 조합이 웹에서 추가 인사이트로 확장

#### 13.6.2 데이터 시너지

- **양방향 데이터 흐름**: 게임 플레이 데이터가 웹 인사이트에 반영되고, 웹 탐색 데이터가 게임 경험을 풍부하게 만듦
- **사용자 행동 분석**: 게임과 웹 양쪽의 사용자 행동을 통합 분석하여 개인화된 추천 제공
- **커뮤니티 형성**: 리더보드를 통한 경쟁과 공유로 사용자 참여도 향상

---

## 14. 추가 위험요인 대응 및 최적화 전략

### 14.1 개요

현재 코드베이스 분석 결과, 다음 7가지 개선 영역이 식별되었습니다. 모든 항목은 기존 기술 스택(Vite, Firebase, Firestore, React) 내에서 구현 가능하며, 신규 인프라 확장 없이 진행합니다.

| 순번 | 개선 항목 | 위험/기회 분류 | 복잡도 | 예상 기간 |
|-----|----------|--------------|-------|----------|
| 1 | 아티스트 이름 정규화 | 위험 대응 | 낮음 | 2일 |
| 2 | AI 응답 스키마 검증 (Zod) | 위험 대응 | 낮음 | 2일 |
| 3 | Firebase Functions 콜드 스타트 최적화 | 위험 대응 | 매우 낮음 | 0.5일 |
| 4 | PWA 오프라인 지원 | 위험 대응 | 낮음 | 3일 |
| 5 | 접근성(A11y) 개선 | 위험 대응 | 낮음 | 5일 |
| 6 | 영구 비교 데이터 저장 | 기회 활용 | 낮음 | 3일 |
| 7 | 테스트 프레임워크 도입 (Vitest) | 위험 대응 | 낮음 | 5일 |

### 14.2 아티스트 이름 정규화

#### 14.2.1 문제 정의

동일 아티스트가 다양한 형태로 입력될 경우 중복 AI 호출 및 캐시 불일치 발생:

```
입력 예시:
- "Henri Matisse"
- "henri matisse"  
- "Henri  Matisse" (공백 2개)
- "Matisse, Henri"
- "앙리 마티스"

→ 모두 다른 캐시 키로 저장되어 AI 중복 호출
```

#### 14.2.2 해결 방안

**파일 위치**: `functions/src/utils/artistNormalization.ts`

```typescript
/**
 * 아티스트 이름 정규화 유틸리티
 * 
 * 목적: 캐시 키 일관성 확보, 중복 AI 호출 방지
 * 예상 효과: AI 호출 비용 30-50% 절감
 */

// 아티스트 이름 별칭 매핑 (한글 ↔ 영문)
const ARTIST_ALIASES: Record<string, string> = {
  // 서양 아티스트
  '앙리 마티스': 'henri matisse',
  '마티스': 'henri matisse',
  '파블로 피카소': 'pablo picasso',
  '피카소': 'pablo picasso',
  '빈센트 반 고흐': 'vincent van gogh',
  '반 고흐': 'vincent van gogh',
  '클로드 모네': 'claude monet',
  '모네': 'claude monet',
  
  // 한국 아티스트
  '이우환': 'lee ufan',
  '박서보': 'park seo-bo',
  '김환기': 'kim whanki',
  '백남준': 'nam june paik',
};

// 불필요한 타이틀 접두사/접미사
const TITLE_PREFIXES = ['sir', 'dame', 'lord', 'lady', 'dr', 'prof'];
const TITLE_SUFFIXES = ['jr', 'sr', 'ii', 'iii', 'iv'];

/**
 * 아티스트 이름을 정규화하여 캐시 키로 변환
 * 
 * @param name - 원본 아티스트 이름
 * @returns 정규화된 캐시 키
 * 
 * @example
 * normalizeArtistName("Henri Matisse") // → "henri_matisse"
 * normalizeArtistName("Matisse, Henri") // → "henri_matisse"
 * normalizeArtistName("앙리 마티스") // → "henri_matisse"
 */
export function normalizeArtistName(name: string): string {
  if (!name) return '';
  
  // 1. 기본 정규화
  let normalized = name
    .toLowerCase()
    .trim()
    .replace(/\s+/g, ' ');
  
  // 2. 별칭 확인 (한글명 → 영문명)
  if (ARTIST_ALIASES[normalized]) {
    normalized = ARTIST_ALIASES[normalized];
  }
  
  // 3. "성, 이름" → "이름 성" 변환
  if (normalized.includes(',')) {
    const parts = normalized.split(',').map(p => p.trim());
    if (parts.length === 2) {
      normalized = `${parts[1]} ${parts[0]}`;
    }
  }
  
  // 4. 특수문자 제거 (한글, 영문, 숫자, 공백만 유지)
  normalized = normalized.replace(/[^\w\s가-힣ㄱ-ㅎㅏ-ㅣ]/g, '');
  
  // 5. 타이틀/접미사 제거
  const words = normalized.split(' ').filter(word => 
    !TITLE_PREFIXES.includes(word) && !TITLE_SUFFIXES.includes(word)
  );
  
  // 6. 캐시 키 형식 (공백 → 언더스코어)
  return words.join('_');
}

/**
 * 캐시 키 생성
 */
export function createCacheKey(prefix: string, artistName: string): string {
  return `${prefix}:${normalizeArtistName(artistName)}`;
}

/**
 * 비교 분석용 캐시 키 (순서 무관)
 * 
 * @example
 * createComparisonCacheKey("Picasso", "Matisse") 
 * createComparisonCacheKey("Matisse", "Picasso")
 * // 둘 다 → "comparison:henri_matisse:pablo_picasso"
 */
export function createComparisonCacheKey(artist1: string, artist2: string): string {
  const normalized1 = normalizeArtistName(artist1);
  const normalized2 = normalizeArtistName(artist2);
  const sorted = [normalized1, normalized2].sort();
  return `comparison:${sorted[0]}:${sorted[1]}`;
}
```

#### 14.2.3 적용 위치

```typescript
// functions/src/index.ts 수정

import { normalizeArtistName, createCacheKey } from './utils/artistNormalization';

export const getDashboardData = onRequest({ cors: true }, async (req, res) => {
  const rawArtistName = req.query.artistName as string;
  
  // 정규화된 캐시 키 사용
  const cacheKey = createCacheKey('dashboard', rawArtistName);
  
  const cached = await getCached<any>("dashboard", cacheKey);
  if (cached) {
    logger.info(`Cache hit: ${cacheKey} (original: ${rawArtistName})`);
    res.json(cached);
    return;
  }
  
  // AI 호출 시에는 원본 이름 사용 (검색 정확도)
  // ...
});
```

### 14.3 AI 응답 스키마 검증 (Zod)

#### 14.3.1 문제 정의

현재 AI 응답 파싱 시 스키마 검증이 없어 예상치 못한 데이터 구조로 런타임 오류 발생 가능:

```typescript
// 현재 문제 코드
let data;
try {
  data = JSON.parse(cleanedText);
} catch (e) {
  data = {};  // ⚠️ 빈 객체로 이후 코드에서 오류 발생
}

// undefined 시 임의 값 사용 → 부정확한 데이터
const result = {
  radar: data.radar?.market || 50,  // ⚠️ 검증 없이 사용
};
```

#### 14.3.2 해결 방안

**패키지 설치**:
```bash
cd functions && npm install zod
```

**파일 위치**: `functions/src/schemas/aiResponses.ts`

```typescript
import { z } from 'zod';

/**
 * AI 응답 스키마 정의
 * 
 * Gemini API 응답의 런타임 검증 및 타입 안전성 확보
 */

// 레이더 차트 메트릭 스키마
export const RadarMetricsSchema = z.object({
  market: z.number().min(0).max(100).default(50),
  critical: z.number().min(0).max(100).default(50),
  historical: z.number().min(0).max(100).default(50),
  social: z.number().min(0).max(100).default(50),
  institutional: z.number().min(0).max(100).default(50),
});

// 궤적 데이터 포인트 스키마
export const TrajectoryPointSchema = z.object({
  year: z.string().regex(/^\d{4}$/),
  value: z.number().min(0).max(100),
});

// 대시보드 응답 전체 스키마
export const DashboardResponseSchema = z.object({
  radar: RadarMetricsSchema,
  trajectory: z.array(TrajectoryPointSchema).min(1).max(20),
  description: z.string().min(1).max(500),
  nationality: z.string().min(1).max(50),
  birthYear: z.number().min(1000).max(2100),
});

// 타임라인 이벤트 스키마
export const TimelineEventSchema = z.object({
  year: z.number().min(1000).max(2100),
  title: z.string().min(1).max(200),
  category: z.enum(['Masterpiece', 'Personal', 'Scandal', 'Exhibition']),
  description: z.string().min(1).max(500),
  impactScore: z.number().min(0).max(100),
  auctionHigh: z.number().min(0).max(100),
  auctionLow: z.number().min(0).max(100),
  visualPrompt: z.string().optional(),
});

// 비교 궤적 데이터 스키마
export const ComparativeDataPointSchema = z.object({
  age: z.number().min(0).max(120),
  a1_total: z.number().min(0).max(100),
  a1_context: z.string().optional(),
  a2_total: z.number().min(0).max(100),
  a2_context: z.string().optional(),
});

export const ComparativeTrajectorySchema = z.object({
  artist1: z.string(),
  artist2: z.string(),
  data: z.array(ComparativeDataPointSchema).min(1),
});

// 타입 추론 (TypeScript 타입 자동 생성)
export type DashboardResponse = z.infer<typeof DashboardResponseSchema>;
export type ComparativeTrajectory = z.infer<typeof ComparativeTrajectorySchema>;
```

**파일 위치**: `functions/src/utils/schemaValidation.ts`

```typescript
import { z, ZodSchema, ZodError } from 'zod';
import * as logger from 'firebase-functions/logger';

interface ValidationResult<T> {
  success: boolean;
  data: T;
  errors?: string[];
  fallbackUsed: boolean;
}

/**
 * AI 응답 스키마 검증
 * 
 * @param schema - Zod 스키마
 * @param data - 검증할 데이터
 * @param fallback - 검증 실패 시 기본값
 * @param context - 로깅용 컨텍스트
 */
export function validateAIResponse<T>(
  schema: ZodSchema<T>,
  data: unknown,
  fallback: T,
  context: string = 'unknown'
): ValidationResult<T> {
  try {
    const validatedData = schema.parse(data);
    return {
      success: true,
      data: validatedData,
      fallbackUsed: false
    };
  } catch (error) {
    if (error instanceof ZodError) {
      const errors = error.errors.map(e => 
        `${e.path.join('.')}: ${e.message}`
      );
      
      logger.warn(`Schema validation failed for ${context}`, {
        errors,
        receivedData: JSON.stringify(data).substring(0, 500),
      });
      
      return {
        success: false,
        data: fallback,
        errors,
        fallbackUsed: true
      };
    }
    
    logger.error(`Unexpected validation error for ${context}`, error);
    return {
      success: false,
      data: fallback,
      errors: ['Unexpected validation error'],
      fallbackUsed: true
    };
  }
}

// 기본 폴백 데이터
export const DEFAULT_FALLBACKS = {
  dashboard: {
    radar: { market: 50, critical: 50, historical: 50, social: 50, institutional: 50 },
    trajectory: [
      { year: '2020', value: 50 },
      { year: '2021', value: 50 },
      { year: '2022', value: 50 },
      { year: '2023', value: 50 },
      { year: '2024', value: 50 },
    ],
    description: '데이터를 가져오는 중 오류가 발생했습니다.',
    nationality: 'Unknown',
    birthYear: 0
  }
};
```

#### 14.3.3 적용 예시

```typescript
// functions/src/index.ts

import { DashboardResponseSchema } from './schemas/aiResponses';
import { validateAIResponse, DEFAULT_FALLBACKS } from './utils/schemaValidation';

export const getDashboardData = onRequest({ cors: true }, async (req, res) => {
  // ... AI 호출 후 ...

  let rawData;
  try {
    rawData = JSON.parse(cleanedText);
  } catch (e) {
    rawData = {};
  }

  // ✅ Zod 스키마 검증
  const validation = validateAIResponse(
    DashboardResponseSchema,
    rawData,
    DEFAULT_FALLBACKS.dashboard,
    `dashboard:${artistName}`
  );

  if (validation.fallbackUsed) {
    logger.warn(`Fallback used for ${artistName}`, { errors: validation.errors });
  }

  const data = validation.data;

  // 검증된 데이터로 결과 구성
  const result = {
    name: artistName,
    nationality: data.nationality,
    birthYear: data.birthYear,
    description: data.description,
    radarData: [
      { axis: "Market Value", value: data.radar.market, fullMark: 100 },
      { axis: "Critical Acclaim", value: data.radar.critical, fullMark: 100 },
      // ...
    ],
    trajectory: data.trajectory.map(p => ({ date: p.year, value: p.value })),
    _validationStatus: validation.success ? 'validated' : 'fallback'
  };

  await setCached("dashboard", cacheKey, result);
  res.json(result);
});
```

### 14.4 Firebase Functions 콜드 스타트 최적화

#### 14.4.1 문제 정의

현재 모든 함수가 기본 설정으로 배포되어 첫 요청 시 3-5초 콜드 스타트 지연 발생.

#### 14.4.2 해결 방안

**파일 위치**: `functions/src/index.ts`

```typescript
// 함수별 최적화 설정

// 자주 사용되는 핵심 API - 콜드 스타트 제거
const HIGH_PRIORITY_CONFIG = {
  cors: true,
  minInstances: 1,        // 항상 1개 인스턴스 유지
  maxInstances: 10,
  concurrency: 80,        // 인스턴스당 동시 처리 수
  timeoutSeconds: 60,
  memory: '512MiB' as const,
  region: 'us-central1',  // 기본 리전 (환경에 따라 변경 가능)
};

// 중간 빈도 API
const STANDARD_CONFIG = {
  cors: true,
  minInstances: 0,
  maxInstances: 10,
  concurrency: 80,
  timeoutSeconds: 60,
  memory: '256MiB' as const,
  region: 'us-central1',  // 기본 리전 (환경에 따라 변경 가능)
};

// 적용
export const getDashboardData = onRequest(HIGH_PRIORITY_CONFIG, async (req, res) => {
  // ... 핵심 대시보드 API
});

export const getArtistReport = onRequest(HIGH_PRIORITY_CONFIG, async (req, res) => {
  // ... 핵심 리포트 API
});

export const getTimelineJourney = onRequest(STANDARD_CONFIG, async (req, res) => {
  // ... 타임라인 API
});

export const getDetailedTrajectory = onRequest(STANDARD_CONFIG, async (req, res) => {
  // ... 비교 궤적 API
});
```

#### 14.4.3 비용 영향

| 설정 | 월 예상 비용 | 콜드 스타트 |
|-----|------------|-----------|
| `minInstances: 1` (2개 함수) | ~$30/월 | 없음 |
| `minInstances: 0` (나머지) | 사용량 기반 | 있음 (3-5초) |

### 14.5 PWA 오프라인 지원

#### 14.5.1 문제 정의

현재 오프라인 상태에서 앱 사용 불가. 네트워크 불안정 시 사용자 경험 저하.

#### 14.5.2 해결 방안

**패키지 설치**:
```bash
npm install -D vite-plugin-pwa
```

**파일 위치**: `vite.config.ts`

```typescript
import path from 'path';
import { defineConfig, loadEnv } from 'vite';
import react from '@vitejs/plugin-react';
import { VitePWA } from 'vite-plugin-pwa';

export default defineConfig(({ mode }) => {
  const env = loadEnv(mode, '.', '');
  return {
    server: {
      port: 3000,
      host: '0.0.0.0',
    },
    plugins: [
      react(),
      VitePWA({
        registerType: 'autoUpdate',
        includeAssets: ['favicon.ico', 'apple-touch-icon.png'],
        
        manifest: {
          name: "Curator's Odysseia - Data Driven Art Archive",
          short_name: 'Curator',
          description: 'AI 기반 아티스트 분석 및 시각화 플랫폼',
          theme_color: '#28317C',
          background_color: '#0a0a0a',
          display: 'standalone',
          orientation: 'portrait',
          start_url: '/',
          icons: [
            {
              src: '/icons/icon-192x192.png',
              sizes: '192x192',
              type: 'image/png'
            },
            {
              src: '/icons/icon-512x512.png',
              sizes: '512x512',
              type: 'image/png',
              purpose: 'any maskable'
            }
          ]
        },
        
        workbox: {
          globPatterns: ['**/*.{js,css,html,ico,png,svg,woff2}'],
          
          runtimeCaching: [
            // API 응답 캐싱 (Stale-While-Revalidate)
            {
              urlPattern: /^https:\/\/.*\.cloudfunctions\.net\/getDashboardData/,
              handler: 'StaleWhileRevalidate',
              options: {
                cacheName: 'dashboard-api-cache',
                expiration: {
                  maxEntries: 50,
                  maxAgeSeconds: 86400  // 24시간
                }
              }
            },
            {
              urlPattern: /^https:\/\/.*\.cloudfunctions\.net\/getArtistReport/,
              handler: 'StaleWhileRevalidate',
              options: {
                cacheName: 'report-api-cache',
                expiration: {
                  maxEntries: 30,
                  maxAgeSeconds: 604800  // 7일
                }
              }
            },
            // 이미지 캐싱
            {
              urlPattern: /^https:\/\/.*\.(png|jpg|jpeg|webp|gif)/,
              handler: 'CacheFirst',
              options: {
                cacheName: 'images-cache',
                expiration: {
                  maxEntries: 100,
                  maxAgeSeconds: 2592000  // 30일
                }
              }
            },
            // Google Fonts
            {
              urlPattern: /^https:\/\/fonts\.googleapis\.com/,
              handler: 'StaleWhileRevalidate',
              options: { cacheName: 'google-fonts-stylesheets' }
            },
            {
              urlPattern: /^https:\/\/fonts\.gstatic\.com/,
              handler: 'CacheFirst',
              options: {
                cacheName: 'google-fonts-webfonts',
                expiration: { maxAgeSeconds: 31536000 }  // 1년
              }
            }
          ]
        },
        
        devOptions: {
          enabled: true,
          type: 'module'
        }
      })
    ],
    define: {
      'process.env.GEMINI_API_KEY': JSON.stringify(env.GEMINI_API_KEY),
      'import.meta.env.VITE_FUNCTIONS_URL': JSON.stringify(
        env.VITE_FUNCTIONS_URL || 'https://us-central1-curatorproto.cloudfunctions.net'
      )
    },
    resolve: {
      alias: {
        '@': path.resolve(__dirname, '.'),
      }
    }
  };
});
```

#### 14.5.3 오프라인 상태 표시 컴포넌트

**파일 위치**: `hooks/useNetworkStatus.ts`

```typescript
import { useState, useEffect, useCallback } from 'react';

interface NetworkStatus {
  isOnline: boolean;
  wasOffline: boolean;
}

export function useNetworkStatus(): NetworkStatus {
  const [status, setStatus] = useState<NetworkStatus>({
    isOnline: navigator.onLine,
    wasOffline: false,
  });

  const handleOnline = useCallback(() => {
    setStatus(prev => ({ isOnline: true, wasOffline: !prev.isOnline }));
  }, []);

  const handleOffline = useCallback(() => {
    setStatus(prev => ({ ...prev, isOnline: false }));
  }, []);

  useEffect(() => {
    window.addEventListener('online', handleOnline);
    window.addEventListener('offline', handleOffline);
    return () => {
      window.removeEventListener('online', handleOnline);
      window.removeEventListener('offline', handleOffline);
    };
  }, [handleOnline, handleOffline]);

  return status;
}
```

**파일 위치**: `components/OfflineIndicator.tsx`

```tsx
import { useNetworkStatus } from '@/hooks/useNetworkStatus';
import { motion, AnimatePresence } from 'framer-motion';

export function OfflineIndicator() {
  const { isOnline, wasOffline } = useNetworkStatus();

  return (
    <AnimatePresence>
      {!isOnline && (
        <motion.div
          initial={{ y: -100, opacity: 0 }}
          animate={{ y: 0, opacity: 1 }}
          exit={{ y: -100, opacity: 0 }}
          className="fixed top-0 left-0 right-0 z-50 bg-amber-500 text-black px-4 py-2 text-center font-medium"
        >
          ⚡ 오프라인 모드 - 캐시된 데이터를 표시합니다
        </motion.div>
      )}
      
      {isOnline && wasOffline && (
        <motion.div
          initial={{ y: -100, opacity: 0 }}
          animate={{ y: 0, opacity: 1 }}
          exit={{ y: -100, opacity: 0 }}
          transition={{ delay: 0.5 }}
          className="fixed top-0 left-0 right-0 z-50 bg-green-500 text-white px-4 py-2 text-center"
        >
          ✓ 온라인으로 복귀했습니다
        </motion.div>
      )}
    </AnimatePresence>
  );
}
```

### 14.6 접근성(A11y) 개선

#### 14.6.1 문제 정의

WCAG 2.2 기준 접근성 검증 미완료. 키보드 네비게이션, 스크린 리더 호환성 미흡.

#### 14.6.2 준수 항목

| WCAG 기준 | 항목 | 구현 방안 |
|----------|------|----------|
| 1.1.1 | 대체 텍스트 | 차트에 데이터 테이블 제공 |
| 1.4.3 | 최소 대비 | 4.5:1 이상 대비비 확보 |
| 2.1.1 | 키보드 접근 | 모든 인터랙티브 요소 키보드 접근 |
| 2.4.7 | 포커스 표시 | 명확한 포커스 인디케이터 |
| 4.1.2 | 이름/역할/값 | 적절한 ARIA 속성 |

#### 14.6.3 접근성 유틸리티

**파일 위치**: `styles/accessibility.css`

```css
/* 스크린 리더 전용 (시각적 숨김) */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/* 포커스 시에만 표시 */
.sr-only-focusable:focus {
  position: static;
  width: auto;
  height: auto;
  padding: inherit;
  margin: inherit;
  overflow: visible;
  clip: auto;
  white-space: normal;
}

/* 고대비 모드 지원 */
@media (prefers-contrast: high) {
  :root {
    --color-primary: #0000ff;
    --color-background: #ffffff;
    --color-text: #000000;
  }
  
  button, a, input {
    border: 2px solid currentColor;
  }
}

/* 모션 감소 설정 존중 */
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* 포커스 인디케이터 강화 */
:focus-visible {
  outline: 3px solid #4299e1;
  outline-offset: 2px;
}
```

#### 14.6.4 접근성 차트 래퍼

**파일 위치**: `components/AccessibleChart.tsx`

```tsx
import { ReactNode } from 'react';

interface AccessibleChartProps {
  title: string;
  description: string;
  data: { label: string; value: number }[];
  children: ReactNode;
}

/**
 * 접근성을 고려한 차트 래퍼
 * 
 * - 시각적 차트와 함께 스크린 리더용 데이터 테이블 제공
 * - WCAG 1.1.1 대체 텍스트 준수
 */
export function AccessibleChart({ 
  title, 
  description, 
  data, 
  children 
}: AccessibleChartProps) {
  return (
    <figure 
      role="img" 
      aria-label={title}
      aria-describedby="chart-description"
    >
      {/* 시각적 차트 */}
      <div aria-hidden="true">
        {children}
      </div>
      
      {/* 스크린 리더용 데이터 (시각적 숨김) */}
      <figcaption id="chart-description" className="sr-only">
        <p>{description}</p>
        <table>
          <caption>{title} 데이터</caption>
          <thead>
            <tr>
              <th scope="col">항목</th>
              <th scope="col">값</th>
            </tr>
          </thead>
          <tbody>
            {data.map((item, index) => (
              <tr key={index}>
                <td>{item.label}</td>
                <td>{item.value}점</td>
              </tr>
            ))}
          </tbody>
        </table>
      </figcaption>
    </figure>
  );
}
```

### 14.7 영구 비교 데이터 저장

#### 14.7.1 목적

비교 분석 데이터를 영구 저장하여:
1. 동일 비교 요청 시 AI 호출 없이 즉시 응답
2. 27 Combinations 패턴 분석 데이터 축적
3. AI 호출 비용 80% 절감 목표

> **참고**: 이 내용은 섹션 10.4의 3-Tier 스토리지 아키텍처와 연계되며, 비교 분석 데이터에 특화된 구현 방법을 제공합니다.

#### 14.7.2 Firestore 컬렉션 구조

```
permanent_comparisons/
├── {normalizedKey}/
│   ├── artist1: string
│   ├── artist2: string
│   ├── normalizedKey: string
│   ├── trajectoryData: array
│   ├── combinationType: string  // 27 Combinations 분류
│   ├── generatedAt: timestamp
│   ├── accessCount: number
│   ├── lastAccessedAt: timestamp
│   └── version: number
```

#### 14.7.3 구현

**파일 위치**: `functions/src/storage/permanentStorage.ts`

```typescript
import { getFirestore, FieldValue } from 'firebase-admin/firestore';
import { normalizeArtistName } from '../utils/artistNormalization';

const db = getFirestore();

interface ComparisonRecord {
  artist1: string;
  artist2: string;
  normalizedKey: string;
  trajectoryData: any[];
  combinationType: string;
  generatedAt: FirebaseFirestore.Timestamp;
  accessCount: number;
  lastAccessedAt: FirebaseFirestore.Timestamp;
  version: number;
}

/**
 * 비교 데이터 영구 저장
 */
export async function saveComparison(
  artist1: string,
  artist2: string,
  data: any[],
  combinationType: string
): Promise<string> {
  const n1 = normalizeArtistName(artist1);
  const n2 = normalizeArtistName(artist2);
  const sortedKey = [n1, n2].sort().join(':');
  
  await db.collection('permanent_comparisons').doc(sortedKey).set({
    artist1,
    artist2,
    normalizedKey: sortedKey,
    trajectoryData: data,
    combinationType,
    generatedAt: FieldValue.serverTimestamp(),
    accessCount: 1,
    lastAccessedAt: FieldValue.serverTimestamp(),
    version: 1
  });

  return sortedKey;
}

/**
 * 영구 저장된 비교 데이터 조회
 */
export async function getComparison(
  artist1: string,
  artist2: string
): Promise<ComparisonRecord | null> {
  const n1 = normalizeArtistName(artist1);
  const n2 = normalizeArtistName(artist2);
  const sortedKey = [n1, n2].sort().join(':');
  
  const doc = await db.collection('permanent_comparisons').doc(sortedKey).get();
  
  if (!doc.exists) return null;
  
  // 접근 횟수 증가
  await doc.ref.update({
    accessCount: FieldValue.increment(1),
    lastAccessedAt: FieldValue.serverTimestamp()
  });
  
  return doc.data() as ComparisonRecord;
}

/**
 * 인기 비교 조합 조회 (분석용)
 */
export async function getPopularComparisons(limit: number = 20) {
  const snapshot = await db.collection('permanent_comparisons')
    .orderBy('accessCount', 'desc')
    .limit(limit)
    .get();
  
  return snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
}
```

#### 14.7.4 Functions 통합

```typescript
// functions/src/index.ts

import { saveComparison, getComparison } from './storage/permanentStorage';

export const getDetailedTrajectory = onRequest(STANDARD_CONFIG, async (req, res) => {
  const { artist1, artist2 } = req.query;
  
  // 1순위: 영구 저장소 확인
  const permanent = await getComparison(artist1 as string, artist2 as string);
  if (permanent) {
    logger.info(`Permanent hit: ${artist1} vs ${artist2}`);
    res.json({
      artist1: permanent.artist1,
      artist2: permanent.artist2,
      data: permanent.trajectoryData,
      _source: 'permanent'
    });
    return;
  }
  
  // 2순위: 세션 캐시 확인
  const cached = await getCached<any>('trajectory', cacheKey);
  if (cached) {
    res.json({ ...cached, _source: 'session_cache' });
    return;
  }
  
  // 3순위: AI 호출 (최후의 수단)
  const aiResponse = await callGeminiForTrajectory(artist1, artist2);
  
  // 영구 저장소에 저장
  await saveComparison(
    artist1 as string,
    artist2 as string,
    aiResponse.data,
    classifyCombinationType(aiResponse)
  );
  
  // 세션 캐시에도 저장
  await setCached('trajectory', cacheKey, aiResponse);
  
  res.json({ ...aiResponse, _source: 'ai' });
});
```

### 14.8 테스트 프레임워크 도입 (Vitest)

#### 14.8.1 목적

- 코드 변경 시 기존 기능 손상 조기 감지
- AI 응답 파싱 로직 검증
- 캐싱 로직 버그 방지

#### 14.8.2 패키지 설치

```bash
# 프론트엔드 테스트
npm install -D vitest @vitest/ui @vitest/coverage-v8 \
  @testing-library/react @testing-library/jest-dom \
  @testing-library/user-event jsdom msw

# Firebase Functions 테스트
cd functions && npm install -D vitest firebase-functions-test
```

#### 14.8.3 설정 파일

**파일 위치**: `vitest.config.ts`

```typescript
import { defineConfig } from 'vitest/config';
import react from '@vitejs/plugin-react';
import path from 'path';

export default defineConfig({
  plugins: [react()],
  test: {
    environment: 'jsdom',
    globals: true,
    setupFiles: ['./tests/setup.ts'],
    include: ['**/*.{test,spec}.{ts,tsx}'],
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html'],
      include: ['services/**/*.ts', 'components/**/*.tsx'],
      exclude: ['**/node_modules/**', '**/dist/**']
    },
    alias: {
      '@': path.resolve(__dirname, '.'),
    }
  }
});
```

**파일 위치**: `tests/setup.ts`

```typescript
import '@testing-library/jest-dom';
import { beforeAll, afterAll, afterEach, vi } from 'vitest';
import { setupServer } from 'msw/node';
import { handlers } from './mocks/handlers';

export const server = setupServer(...handlers);

beforeAll(() => server.listen({ onUnhandledRequest: 'error' }));
afterEach(() => {
  server.resetHandlers();
  vi.clearAllMocks();
});
afterAll(() => server.close());

// Firebase 모킹
vi.mock('firebase/firestore', () => ({
  getFirestore: vi.fn(),
  collection: vi.fn(),
  doc: vi.fn(),
  getDoc: vi.fn(),
  setDoc: vi.fn(),
  serverTimestamp: vi.fn(() => new Date()),
}));
```

#### 14.8.4 테스트 예시

**파일 위치**: `tests/utils/artistNormalization.test.ts`

```typescript
import { describe, it, expect } from 'vitest';
import { 
  normalizeArtistName, 
  createCacheKey, 
  createComparisonCacheKey 
} from '@/functions/src/utils/artistNormalization';

describe('artistNormalization', () => {
  describe('normalizeArtistName', () => {
    it('기본 정규화: 소문자 변환 및 공백 정리', () => {
      expect(normalizeArtistName('Henri Matisse')).toBe('henri_matisse');
      expect(normalizeArtistName('Henri  Matisse')).toBe('henri_matisse');
      expect(normalizeArtistName('  Henri Matisse  ')).toBe('henri_matisse');
    });
    
    it('성, 이름 형식 처리', () => {
      expect(normalizeArtistName('Matisse, Henri')).toBe('henri_matisse');
    });
    
    it('한글 별칭 처리', () => {
      expect(normalizeArtistName('앙리 마티스')).toBe('henri_matisse');
      expect(normalizeArtistName('마티스')).toBe('henri_matisse');
    });
    
    it('빈 문자열 처리', () => {
      expect(normalizeArtistName('')).toBe('');
      expect(normalizeArtistName('   ')).toBe('');
    });
  });
  
  describe('createComparisonCacheKey', () => {
    it('순서와 무관하게 동일한 키 생성', () => {
      const key1 = createComparisonCacheKey('Picasso', 'Matisse');
      const key2 = createComparisonCacheKey('Matisse', 'Picasso');
      expect(key1).toBe(key2);
    });
  });
});
```

**파일 위치**: `tests/schemas/aiResponses.test.ts`

```typescript
import { describe, it, expect } from 'vitest';
import { DashboardResponseSchema } from '@/functions/src/schemas/aiResponses';

describe('AI Response Schemas', () => {
  describe('DashboardResponseSchema', () => {
    it('유효한 응답 검증 통과', () => {
      const validData = {
        radar: { market: 80, critical: 90, historical: 85, social: 75, institutional: 88 },
        trajectory: [
          { year: '2020', value: 70 },
          { year: '2021', value: 75 },
        ],
        description: '테스트 설명',
        nationality: 'French',
        birthYear: 1869
      };
      
      const result = DashboardResponseSchema.safeParse(validData);
      expect(result.success).toBe(true);
    });
    
    it('범위 초과 값 검증 실패', () => {
      const invalidData = {
        radar: { market: 150, critical: 90, historical: 85, social: 75, institutional: 88 },
        trajectory: [],
        description: '',
        nationality: 'French',
        birthYear: 1869
      };
      
      const result = DashboardResponseSchema.safeParse(invalidData);
      expect(result.success).toBe(false);
    });
    
    it('기본값 적용', () => {
      const partialData = {
        radar: {},
        trajectory: [{ year: '2020', value: 50 }],
        description: '설명',
        nationality: 'Korean',
        birthYear: 1930
      };
      
      const result = DashboardResponseSchema.safeParse(partialData);
      expect(result.success).toBe(true);
      if (result.success) {
        expect(result.data.radar.market).toBe(50);  // 기본값
      }
    });
  });
});
```

#### 14.8.5 package.json 스크립트 추가

```json
{
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview",
    "test": "vitest",
    "test:ui": "vitest --ui",
    "test:coverage": "vitest run --coverage"
  }
}
```

### 14.9 실행 계획 및 의존성

#### 14.9.1 의존성 그래프

```
┌───────────────────────────────────────────────────────────────────┐
│                    Phase 1 (동시 진행 가능)                        │
├───────────────────────────────────────────────────────────────────┤
│  [2] 이름 정규화        [4] PWA 설정       [3] 콜드 스타트 최적화   │
│  (functions/)          (vite.config.ts)   (functions/ 설정만)     │
│  Day 1-2               Day 1-3            Day 1 (0.5일)          │
└───────────────┬─────────────────────────────────────────┬─────────┘
                │                                         │
                ▼                                         │
┌───────────────────────────────┐                        │
│      Phase 2                   │                        │
├───────────────────────────────┤                        │
│  [1] Zod 스키마 검증           │◄───────────────────────┘
│  (이름 정규화와 같은 파일 수정) │
│  Day 3-4                       │
└───────────────┬───────────────┘
                │
                ▼
┌───────────────────────────────┐
│      Phase 3                   │
├───────────────────────────────┤
│  [6] 영구 비교 데이터 저장      │
│  (정규화된 키 사용)            │
│  Day 5-7                       │
└───────────────┬───────────────┘
                │
                ▼
┌───────────────────────────────────────────────────────────────────┐
│                    Phase 4 (동시 진행 가능)                        │
├───────────────────────────────────────────────────────────────────┤
│  [5] 접근성 개선               [7] Vitest 테스트                   │
│  (components/)                (모든 기능 완료 후 테스트 작성)      │
│  Day 8-12                     Day 8-14                            │
└───────────────────────────────────────────────────────────────────┘
```

#### 14.9.2 실행 일정

| Week | Day | 작업 항목 | 담당 영역 |
|------|-----|----------|----------|
| 1 | 1-2 | 이름 정규화, 콜드 스타트 최적화 | Backend |
| 1 | 1-3 | PWA 설정 | Frontend |
| 1 | 3-4 | Zod 스키마 검증 | Backend |
| 1 | 5-7 | 영구 비교 데이터 저장 | Backend |
| 2 | 8-12 | 접근성 개선 | Frontend |
| 2 | 8-14 | Vitest 테스트 | Both |

#### 14.9.3 예상 효과

| 개선 항목 | 정량적 효과 |
|----------|-----------|
| 이름 정규화 | AI 중복 호출 30-50% 감소 |
| Zod 검증 | 런타임 오류 90% 감소 |
| 콜드 스타트 최적화 | 첫 응답 3-5초 단축 |
| PWA 오프라인 | 오프라인 사용 가능 |
| 접근성 개선 | WCAG 2.2 AA 준수 |
| 영구 저장 | AI 호출 비용 80% 절감 |
| 테스트 | 리그레션 버그 80% 조기 감지 |

---

## 15. 부록

### 15.1 주요 컴포넌트 파일 구조

```
CURATOR/
├── App.tsx                    # 메인 앱 컴포넌트, 라우팅, 상태 관리
├── components/
│   ├── RadarChartComponent.tsx      # 레이더 차트 (단일/듀얼)
│   ├── LineChartComponent.tsx       # 라인 차트 (트라젝토리)
│   ├── DualAreaChartComponent.tsx   # 듀얼 에어리어 차트 (비교)
│   ├── ConnectedTab.tsx             # 연결된 아티스트 비교 뷰
│   ├── DeepDiveTab.tsx               # 심층 분석 탭
│   ├── DeepDiveChat.tsx              # 채팅 인터페이스
│   ├── FlashlightGateway.tsx         # 타임라인 진입 게이트웨이
│   ├── TimelineJourney.tsx           # 타임라인 여정 시각화
│   ├── TrajectoryTunnel.tsx          # 트라젝토리 터널 (비교)
│   └── AIReport.tsx                  # AI 리포트 컴포넌트
├── services/
│   ├── geminiService.ts              # Firebase Functions 호출
│   ├── cacheService.ts                # Firestore 클라이언트 캐싱
│   ├── artistImageService.ts          # 작가 이미지 검색
│   ├── artistListService.ts           # 작가 목록 무한 스크롤
│   └── requestDeduplication.ts       # 중복 요청 방지
├── functions/
│   └── src/
│       ├── index.ts                   # Firebase Functions 엔드포인트 (10개)
│       └── utils/
│           ├── cache.ts               # Firestore 서버 사이드 캐싱
│           ├── googleSearch.ts        # Google Custom Search API
│           └── imageSearch.ts        # 이미지 검색 (Wikipedia + Google CSE)
├── types.ts                          # TypeScript 타입 정의
└── constants.ts                      # 상수 및 Mock 데이터
```

### 15.2 주요 타입 정의

```typescript
// 핵심 타입들
- Artist: 아티스트 기본 정보
- DashboardData: 대시보드 데이터
- TimelineData: 타임라인 데이터 (Eras, Events, Critiques, Masterpieces)
- ComparativeTrajectory: 비교 트라젝토리 데이터
- AIReportResult: AI 리포트 결과
- AxisData: 레이더 차트 축 데이터
- TimeSeriesPoint: 시계열 데이터 포인트
- Masterpiece: 대표작 정보 (imageUrl 포함)
```

### 15.3 주요 상수

- **COLORS**: 차트 색상 체계
- **METRIC_DETAILS**: 메트릭 상세 설명
- **MOCK_ARTISTS**: 27명의 Mock 아티스트 데이터
- **CHIPS**: 채팅 인터페이스 메트릭 칩

### 15.4 성능 최적화 전략

#### 프론트엔드 최적화
1. **Lazy Loading**: IntersectionObserver 기반 FadeInSection
2. **이미지 최적화**: 지연 로딩, 결정론적 플레이스홀더
3. **애니메이션 최적화**: Framer Motion 하드웨어 가속
4. **프리로딩**: Connected Tab 진입 시 예측 프리로딩 (계획됨)
5. **점진적 로딩**: Streaming Response로 기본 구조 먼저 표시 (계획됨)

#### 백엔드 최적화
1. **3-Tier 스토리지**: Memory Cache → Session Cache → Knowledge Base (계획됨)
2. **영구 저장**: 아티스트 기본 정보 및 메트릭 영구 저장으로 재조회 시 AI 호출 제거 (계획됨)
3. **캐싱**: Firestore 기반 24시간 TTL 캐싱 (현재 구현됨)
4. **지수 백오프**: Rate Limit 및 일시적 오류 시 자동 재시도 (계획됨)
5. **Request Deduplication**: 중복 요청 방지 (현재 구현됨)
6. **폴백 전략**: API 실패 시 Mock 데이터 사용 (현재 구현됨)
7. **Google Custom Search API 우선 사용**: Gemini Search Grounding보다 빠른 응답 (현재 구현됨)

### 15.5 접근성 고려사항

- **키보드 네비게이션**: 모든 인터랙티브 요소 키보드 접근 가능
- **스크린 리더**: ARIA 레이블 및 역할 정의
- **색상 대비**: WCAG AA 기준 준수
- **반응형 디자인**: 모바일 우선 접근

### 15.6 용어집

- **노트 (Note)**: 게임에서 플레이어가 자르는 작품을 상징하는 게임 오브젝트
- **Tier**: 작품의 등급 (Masterpiece, Exhibition, Sketch)
- **Axis**: 작품의 성격과 맥락 (Institution, Academic, Discourse, Network)
- **Gate**: 큐레이터의 선택을 상징하는 게임 요소
- **27 Combinations**: Phase 1-3의 3×3×3 매트릭스로 구성된 랭킹 시스템
- **Valuation Matrix**: 5축 레이더 차트로 아티스트 메트릭 시각화
- **Trajectory Index**: 시간별 가치 추이 라인 차트
- **Grounding Source**: AI 생성 콘텐츠의 정보 출처

### 15.7 참고 자료

- **Google Gemini 2.5 Flash**: AI 모델
- **Google Custom Search API**: 웹 검색 및 이미지 검색
- **Firebase Functions 2세대**: 서버리스 백엔드
- **Firestore**: NoSQL 데이터베이스 (캐싱)
- **Recharts**: React 차트 라이브러리
- **Framer Motion**: React 애니메이션 라이브러리
- **Tone.js**: 웹 오디오 프레임워크

### 15.8 문서 이력

- **v1.2** (2025년 1월): 추가 위험요인 대응 및 최적화 전략 확장
  - 아티스트 이름 정규화 전략 추가
  - AI 응답 스키마 검증 (Zod) 도입
  - Firebase Functions 콜드 스타트 최적화
  - PWA 오프라인 지원
  - 접근성(A11y) 개선 상세화
  - 영구 비교 데이터 저장 구체화
  - 테스트 프레임워크 (Vitest) 도입 계획
  
- **v1.1** (2025년 1월): 백엔드 최적화 전략 확장
  - 지수 백오프 전략 추가
  - 3-Tier 스토리지 아키텍처 설계
  - 로딩 시간 최적화 전략 (프리로딩, 점진적 로딩)
  - 비용 최적화 전략 및 영구 데이터 저장 정책
  - 게임-웹 통합 아키텍처 상세화 (섹션 13 신규 추가)
  
- **v1.0** (2025년 1월): 통합 BRD 문서 초기 작성
  - 웹 애플리케이션 (메인) + 게임 프로모션 기능 통합
  - 현재 코드베이스 상태 정확히 반영
  - CuratorsOdysseia_ProjectProposal.md 구조 따름

---

**문서 작성일**: 2025년 1월  
**작성자**: AI Assistant  
**검토 상태**: 추가 위험요인 대응 전략 확장 완료  
**다음 검토 예정일**: 프로젝트 진행에 따라 업데이트  
**문서 버전**: 1.2

---

*Curator's Odysseia - Data Driven Art Archive*  
*© 2025 All Rights Reserved*

